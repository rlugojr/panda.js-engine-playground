// Panda Engine 2.0.0 - http://www.pandajs.net
var game={version:"2.0.0",config:"undefined"!=typeof pandaConfig?pandaConfig:{},delta:0,scale:1,audio:null,scene:null,debug:null,system:null,pool:null,storage:null,tween:null,input:null,keyboard:null,device:{},devicemotion:null,moduleQueue:[],assetQueue:[],audioQueue:[],paths:{},plugins:{},json:{},modules:{},width:0,height:0,_coreModules:["engine.analytics","engine.audio","engine.camera","engine.debug","engine.geometry","engine.input","engine.loader","engine.particle","engine.physics","engine.pool","engine.renderer.animation","engine.renderer.container","engine.renderer.core","engine.renderer.graphics","engine.renderer.sprite","engine.renderer.spritesheet","engine.renderer.text","engine.renderer.texture","engine.renderer.tilingsprite","engine.renderer.webgl","engine.scene","engine.storage","engine.system","engine.timer","engine.tween"],_nocache:"",_fnTest:/xyz/.test(function(){var e;return e})?/\bsuper\b/:/[\D|\d]*/,_initializing:!1,_loadFinished:!1,_waitForLoad:0,_DOMLoaded:!1,_gameLoopId:1,_gameLoops:{},_current:null,_loader:null,_currentModule:null,_gameModuleDefined:!1,clearCache:function(){this.Texture.clearCache(),this.BaseTexture.clearCache(),this.Font.clearCache(),this.json={},this.paths={}},module:function(e){if(this._current)throw"module "+this._current.name+" has no body";if(this.modules[e]&&this.modules[e].body)throw"module "+e+" is already defined";if(this._current={name:e,requires:[],loaded:!1,classes:[]},0===e.indexOf("game.")&&(this._gameModuleDefined=!0,this._current.requires.push("engine.core")),this.modules[e]=this._current,this.moduleQueue.push(this._current),"engine.core"===e){if(this.config.ignoreModules)for(var t=this._coreModules.length-1;t>=0;t--)-1!==this.config.ignoreModules.indexOf(this._coreModules[t])&&this._coreModules.splice(t,1);this._current.requires=this._coreModules,this.body(function(){})}return this},require:function(e){var t,e=Array.prototype.slice.call(arguments);for(t=0;t<e.length;t++)e[t]&&-1===this._current.requires.indexOf(e[t])&&this._current.requires.push(e[t]);return this},body:function(e){this._current.body=e,this._current=null,this._loadFinished&&this._loadModules(),this._gameModuleDefined&&this._DOMLoaded&&!this._loadFinished&&this._loadModules()},onStart:function(){},ready:function(){},createClass:function(e,t,i){if("object"==typeof e)return this.Class.extend(e);if(this[e])throw"class "+e+" already created";return"object"==typeof t&&(i=t,t="Class"),this[e]=this[t].extend(i),this._currentModule.classes.push(e),this[e]},createScene:function(e,t){return this.createClass(e,"Scene",t)},addAttributes:function(e,t){if(!this[e])throw"class "+e+" not found";for(var i in t)this[e][i]=t[i]},defineProperties:function(e,t){if(!this[e])throw"class "+e+" not found";for(var i in t)Object.defineProperty(this[e].prototype,i,{get:t[i].get,set:t[i].set})},vibrate:function(e){navigator.vibrate&&navigator.vibrate(e||500)},fullscreen:function(){this.system.canvas.requestFullscreen?this.system.canvas.requestFullscreen():this.system.canvas.requestFullScreen&&this.system.canvas.requestFullScreen()},fullscreenSupport:function(){return!(!this.system.canvas.requestFullscreen&&!this.system.canvas.requestFullScreen)},addAsset:function(e,t){this._addFileToQueue(e,t,"assetQueue")},addAudio:function(e,t){this._addFileToQueue(e,t,"audioQueue")},getJSON:function(e){return this.json[this.paths[e]]},copy:function(e){var t,i,s;if(!e||"object"!=typeof e||e instanceof HTMLElement||e instanceof this.Class||this.Container&&e instanceof this.Container)return e;if(e instanceof Array){for(i=[],s=0,t=e.length;t>s;s++)i[s]=this.copy(e[s]);return i}i={};for(s in e)i[s]=this.copy(e[s]);return i},merge:function(e,t){for(var i in t){var s=t[i];"object"!=typeof s||s instanceof HTMLElement||s instanceof this.Class||s instanceof this.Container?e[i]=s:(e[i]&&"object"==typeof e[i]||(e[i]=s instanceof Array?[]:{}),this.merge(e[i],s))}return e},ksort:function(e,t){if(!e||"object"!=typeof e)return!1;var i,s=[],n={};for(i in e)s.push(i);for(s.sort(t),i=0;i<s.length;i++)n[s[i]]=e[s[i]];return n},_start:function(){if(!(this.moduleQueue.length>0)){this.system=new this.System,this.renderer=new this.Renderer,this.system._onWindowResize(),this.input=new this.Input(this.renderer.canvas),this.Keyboard&&(this.keyboard=new this.Keyboard),this.Audio&&(this.audio=new this.Audio),this.Pool&&(this.pool=new this.Pool),this.Debug&&this.Debug.enabled&&(this.debug=new this.Debug),this.Storage&&this.Storage.id&&(this.storage=new this.Storage),this.Analytics&&this.Analytics.id&&(this.analytics=new this.Analytics),this.TweenEngine&&(this.tween=new this.TweenEngine);for(var e in this.plugins)this.plugins[e]=new this.plugins[e];var t=this.Loader.className;this._loader=new this[t](this.System.startScene),this.system._rotateScreenVisible||this._loader.start(),this.onStart()}},_setVendorAttribute:function(e,t,i){var s=t.ucfirst();e[t]=e["ms"+s]=e["moz"+s]=e["webkit"+s]=e["o"+s]=i},_getVendorAttribute:function(e,t){var i=t.ucfirst();return e[t]||e["ms"+i]||e["moz"+i]||e["webkit"+i]||e["o"+i]},_normalizeVendorAttribute:function(e,t){if(!e[t]){var i=this._getVendorAttribute(e,t);e[t]=e[t]||i}},_addFileToQueue:function(e,t,i){if(!(t&&this.paths[t]||this.paths[e])){var s=this._getFilePath(e)+this._nocache;return t&&(this.paths[t]=s),this.paths[e]=s,-1===this[i].indexOf(s)&&this[i].push(s),t}},_getFilePath:function(e){return-1!==e.indexOf("://")?e:(this.config.mediaFolder&&(e=this.config.mediaFolder+"/"+e),e)},_loadScript:function(e,t){this.modules[e]=!0,this._waitForLoad++;var i=e.replace(/\./g,"/")+".js"+this._nocache;this.config.sourceFolder&&(i=this.config.sourceFolder+"/"+i);var s=document.createElement("script");s.type="text/javascript",s.src=i,s.onload=this._scriptLoaded.bind(this),s.onerror=function(){throw"Error loading module "+e+" at "+i+" required from "+t},document.getElementsByTagName("head")[0].appendChild(s)},_scriptLoaded:function(){this._waitForLoad--,this._loadModules()},_loadModules:function(){var e,t,i,s,n,a;for(t=0;t<this.moduleQueue.length;t++){for(s=this.moduleQueue[t],a=!0,i=0;i<s.requires.length;i++)n=s.requires[i],this.modules[n]?this.modules[n].loaded||(a=!1):(a=!1,this._loadScript(n,s.name));a&&s.body&&(this.moduleQueue.splice(t,1),s.loaded=!0,this._currentModule=s,s.body(),e=!0,t--,0===this.moduleQueue.length&&this._modulesLoaded())}if(e&&this.moduleQueue.length>0)this._loadModules();else{if(0===this._waitForLoad&&0!==this.moduleQueue.length){var r=[];for(t=0;t<this.moduleQueue.length;t++){var o=[],h=this.moduleQueue[t].requires;for(i=0;i<h.length;i++)s=this.modules[h[i]],s&&s.loaded||o.push(h[i]);r.push(this.moduleQueue[t].name+" (requires: "+o.join(", ")+")")}throw"unresolved modules:\n"+r.join("\n")}this._loadFinished=!0}},_modulesLoaded:function(){for(var e in this.config){var t=e.ucfirst();if(this[t])for(var i in this.config[e])this[t][i]=this.config[e][i]}this.config.autoStart===!1||this.system?this.ready():this._start()},_setGameLoop:function(e){if(this.System.frameRate)return window.setInterval(e,1e3/this.System.frameRate);if(window.requestAnimationFrame){var t=this._gameLoopId++;this._gameLoops[t]=!0;var i=function(){game._gameLoops[t]&&(window.requestAnimationFrame(i),e())};return window.requestAnimationFrame(i),t}return window.setInterval(e,1e3/60)},_clearGameLoop:function(e){this._gameLoops[e]?delete this._gameLoops[e]:window.clearInterval(e)},_boot:function(){if(this.config.noCanvasURL){var e=document.createElement("canvas"),t=!(!e.getContext||!e.getContext("2d"));if(!t)return void(window.location=this.config.noCanvasURL)}delete window.pandaConfig,Math.distance=function(e,t,i,s){return e=i-e,t=s-t,Math.sqrt(e*e+t*t)},Math._random=Math.random,Math.random=function(e,t){return"number"==typeof t?Math._random()*(t-e)+e:Math._random(e)},Number.prototype.limit=function(e,t){var i=this;return e>i&&(i=e),i>t&&(i=t),i},Number.prototype.round=function(e){return e=e?Math.pow(10,e):1,Math.round(this*e)/e},Number.prototype.random=function(){return Math.random()*this},Array.prototype.erase=function(e){for(var t=this.length;t>=0;t--)if(this[t]===e)return this.splice(t,1),this;return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.shuffle=function(){for(var e=this.length,t=e;t--;){var i=parseInt(Math.random()*e),s=this[t];this[t]=this[i],this[i]=s}return this},Array.prototype.last=function(){return this[this.length-1]},Function.prototype.bind=function(e){var t=this,i=[];return Array.prototype.push.apply(i,arguments),i.shift(),function(){var s=[];return Array.prototype.push.apply(s,i),Array.prototype.push.apply(s,arguments),t.apply(e,s)}},String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},this._normalizeVendorAttribute(window,"requestAnimationFrame"),this._normalizeVendorAttribute(navigator,"vibrate"),this.device.pixelRatio=window.devicePixelRatio||1,this.device.screen={width:window.screen.availWidth*this.device.pixelRatio,height:window.screen.availHeight*this.device.pixelRatio},this.device.iPod=/iPod/i.test(navigator.userAgent),this.device.iPhone=/iPhone/i.test(navigator.userAgent),this.device.iPhone4=this.device.iPhone&&2===this.device.pixelRatio&&920===this.device.screen.height,this.device.iPhone5=this.device.iPhone&&2===this.device.pixelRatio&&1096===this.device.screen.height,this.device.iPad=/iPad/i.test(navigator.userAgent),this.device.iPadRetina=this.device.iPad&&2===this.device.pixelRatio,this.device.iOS=this.device.iPod||this.device.iPhone||this.device.iPad,this.device.iOS5=this.device.iOS&&/OS 5/i.test(navigator.userAgent),this.device.iOS6=this.device.iOS&&/OS 6/i.test(navigator.userAgent),this.device.iOS7=this.device.iOS&&/OS 7/i.test(navigator.userAgent),this.device.iOS71=this.device.iOS&&/OS 7_1/i.test(navigator.userAgent),this.device.iOS8=this.device.iOS&&/OS 8/i.test(navigator.userAgent),this.device.android=/android/i.test(navigator.userAgent),this.device.android2=/android 2/i.test(navigator.userAgent);var i=navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);if(this.device.androidStock=!!(i&&i[1]<537),this.device.ie9=/MSIE 9/i.test(navigator.userAgent),this.device.ie10=/MSIE 10/i.test(navigator.userAgent),this.device.ie11=/rv:11.0/i.test(navigator.userAgent),this.device.ie=this.device.ie10||this.device.ie11||this.device.ie9,this.device.wp7=/Windows Phone OS 7/i.test(navigator.userAgent),this.device.wp8=/Windows Phone 8/i.test(navigator.userAgent),this.device.wp=this.device.wp7||this.device.wp8,this.device.wt=this.device.ie&&/Tablet/i.test(navigator.userAgent),this.device.opera=/Opera/i.test(navigator.userAgent)||/OPR/i.test(navigator.userAgent),this.device.crosswalk=/Crosswalk/i.test(navigator.userAgent),this.device.cocoonJS=!!navigator.isCocoonJS,this.device.cocoonCanvasPlus=/CocoonJS/i.test(navigator.browser),this.device.ejecta=/Ejecta/i.test(navigator.userAgent),this.device.facebook=/FB/i.test(navigator.userAgent),this.device.wiiu=/Nintendo WiiU/i.test(navigator.userAgent),this.device.mobile=this.device.iOS||this.device.android||this.device.wp||this.device.wt,"undefined"==typeof navigator.plugins||0===navigator.plugins.length)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),this.device.flash=!0}catch(s){this.device.flash=!1}else this.device.flash=!!navigator.plugins["Shockwave Flash"];for(var n in this.device)if(this.device[n]&&this.config[n])for(var a in this.config[n])"object"==typeof this.config[n][a]?this.merge(this.config[a],this.config[n][a]):this.config[a]=this.config[n][a];if((document.location.href.match(/\?nocache/)||this.config.disableCache)&&(this._nocache="?"+Date.now()),"undefined"==typeof this.config.sourceFolder&&(this.config.sourceFolder="src"),"undefined"==typeof this.config.mediaFolder&&(this.config.mediaFolder="media"),this.device.mobile){var r=document.getElementsByTagName("meta");for(n=0;n<r.length;n++)if("viewport"===r[n].name){var o=!0;break}if(!o){var h=document.createElement("meta");h.name="viewport";var u="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no";this.device.iOS71&&(u+=",minimal-ui"),h.content=u,document.getElementsByTagName("head")[0].appendChild(h)}}this.device.mobile&&window.addEventListener("devicemotion",function(e){game.devicemotion=e.accelerationIncludingGravity}),this.module("engine.core"),"complete"===document.readyState?this._DOMReady():(document.addEventListener("DOMContentLoaded",this._DOMReady.bind(this),!1),window.addEventListener("load",this._DOMReady.bind(this),!1))},_DOMReady:function(){if(!this._DOMLoaded){if(!document.body)return setTimeout(this._DOMReady.bind(this),13);this._DOMLoaded=!0,this._gameModuleDefined&&this._loadModules()}}};game.Core=game,game.Class=function(){},game.Class.extend=function(e){function t(){if(game._initializing)return this;for(var e in this)"object"==typeof this[e]&&(this[e]=game.copy(this[e]));return this.staticInit&&this.staticInit.apply(this,arguments),this.init&&this.init.apply(this,arguments),game.scene&&"function"==typeof this.update&&this!==game.scene&&game.scene.addObject(this),this}var i=this.prototype;game._initializing=!0;var s=new this;game._initializing=!1;var n=function(e,t){return function(){var s=this["super"];this["super"]=i[e];var n=t.apply(this,arguments);return this["super"]=s,n}};for(var a in e)s[a]="function"==typeof e[a]&&"function"==typeof i[a]&&game._fnTest.test(e[a])?n(a,e[a]):e[a];return t.prototype=s,t.prototype.constructor=t,t.extend=game.Class.extend,t.inject=function(e){var t=this.prototype,i={},s=function(e,t){return function(){var s=this["super"];this["super"]=i[e];var n=t.apply(this,arguments);return this["super"]=s,n}};for(var n in e)"function"==typeof e[n]&&"function"==typeof t[n]&&game._fnTest.test(e[n])?(i[n]=t[n],t[n]=s(n,e[n])):t[n]=e[n]},t},"undefined"!=typeof exports?exports=module.exports=game:game._boot(),game.module("engine.analytics").body(function(){game.createClass("Analytics",{trackId:null,_clientId:null,init:function(e){if(this.trackId=e||game.Analytics.id,navigator.onLine)if(game.device.cocoonJS){this._clientId=Date.now();var t=new XMLHttpRequest,i="v=1&tid="+this.trackId+"&cid="+this._clientId+"&t=pageview&dp=%2F";t.open("POST","http://www.google-analytics.com/collect",!0),t.send(i)}else!function(e,t,i,s,n,a,r){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,a=t.createElement(i),r=t.getElementsByTagName(i)[0],a.async=1,a.src=s,r.parentNode.insertBefore(a,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",e,"auto"),ga("send","pageview")},send:function(e,t,i,s){if(navigator.onLine)if(game.device.cocoonJS){var n=new XMLHttpRequest,a="v=1&tid="+this.trackId+"&cid="+this._clientId+"&t=event&ec="+e+"&ea="+t;"undefined"!=typeof i&&(a+="&el="+i),"undefined"!=typeof s&&(a+="&ev="+s),n.open("POST","http://www.google-analytics.com/collect",!0),n.send(a)}else ga("send","event",e,t,i,s)}}),game.addAttributes("Analytics",{id:""})}),game.module("engine.audio").body(function(){game.createClass("Audio",{currentMusic:null,currentMusicName:null,formats:[],musicMuted:!1,pausedSounds:[],playingSounds:[],soundMuted:!1,_audioId:1,_audioObjects:{},_sources:{},_systemPaused:[],init:function(){if(game._normalizeVendorAttribute(window,"AudioContext"),game.device.iOS5&&(game.Audio.enabled=!1),game.device.wp7&&(game.Audio.enabled=!1),game.device.android2&&(game.Audio.enabled=!1),game.Audio.enabled||(game.Audio.webAudio=!1),game.Audio.webAudio&&!window.AudioContext&&(game.Audio.webAudio=!1),game.Audio.enabled)for(var e=new Audio,t=0;t<game.Audio.formats.length;t++)e.canPlayType(game.Audio.formats[t].type)&&this.formats.push(game.Audio.formats[t].ext);game.device.opera&&game.Audio.webAudio&&this.formats.erase("m4a"),0===this.formats.length&&(game.Audio.enabled=!1),game.Audio.enabled&&game.Audio.webAudio&&(this.context=new AudioContext,this.gainNode=this.context.createGain?this.context.createGain():this.context.createGainNode(),this.gainNode.connect(this.context.destination)),this.musicVolume=game.Audio.musicVolume,this.soundVolume=game.Audio.soundVolume},fadeIn:function(e,t){return this._fade(e,t,1)},fadeOut:function(e,t){return this._fade(e,t,0)},playSound:function(e,t,i,s){var n=this.soundMuted?0:this.soundVolume,a=this._play(e,t,n,i,s);return a&&this.playingSounds.push(a),a},stopSound:function(e,t){if(e)return this._stop(e,!!t);for(var i=this.playingSounds.length-1;i>=0;i--)this._stop(this.playingSounds[i],!!t);return!0},stopSoundByName:function(e,t){for(var i in this._audioObjects)this._audioObjects[i].name===e&&this.stopSound(i,t)},pauseSound:function(e){if(e){var t=this.playingSounds.indexOf(e);if(-1===t)return!1;this._pause(e),this.playingSounds.splice(t,1),this.pausedSounds.push(e)}else{for(var i=this.playingSounds.length-1;i>=0;i--)this._pause(this.playingSounds[i]),this.pausedSounds.push(this.playingSounds[i]);this.playingSounds.length=0}return!0},resumeSound:function(e){var t=this.pausedSounds.indexOf(e);return-1===t?!1:(this._resume(e),this.playingSounds.push(e),this.pausedSounds.splice(t,1),!0)},muteSound:function(e){if(e)return this._mute(e);this.soundMuted=!0;var t;for(t=this.playingSounds.length-1;t>=0;t--)this._mute(this.playingSounds[t]);for(t=this.pausedSounds.length-1;t>=0;t--)this._mute(this.pausedSounds[t]);return!0},unmuteSound:function(e){if(e)return this._unmute(e,this.soundVolume);this.soundMuted=!1;var t;for(t=this.playingSounds.length-1;t>=0;t--)this._unmute(this.playingSounds[t],this.soundVolume);for(t=this.pausedSounds.length-1;t>=0;t--)this._unmute(this.pausedSounds[t],this.soundVolume);return!0},playMusic:function(e,t){var i=this.musicMuted?0:this.musicVolume;return"undefined"==typeof t&&(t=!0),this.currentMusic&&this._stop(this.currentMusic),this.currentMusic=this._play(e,!!t,i),this.currentMusicName=e,this.currentMusic},stopMusic:function(){var e=this._stop(this.currentMusic);return this.currentMusic=null,this.currentMusicName=null,e},pauseMusic:function(){return this._pause(this.currentMusic)},resumeMusic:function(){return this._resume(this.currentMusic)},muteMusic:function(){this.musicMuted=!0,this.currentMusic&&this._mute(this.currentMusic)},unmuteMusic:function(){this.musicMuted=!1,this.currentMusic&&this._unmute(this.currentMusic,this.musicVolume)},setVolume:function(e,t){var i=this._audioObjects[e];return i?void(this.context?i.gainNode.gain.value=t:i.volume=t):!1},setSoundVolume:function(e){this.soundVolume=e;var t;for(t=this.playingSounds.length-1;t>=0;t--)this.context?this._audioObjects[this.playingSounds[t]].gainNode.gain.value=this.soundVolume:this.playingSounds[t].volume=this.soundVolume;for(t=this.pausedSounds.length-1;t>=0;t--)this.context?this._audioObjects[this.pausedSounds[t]].gainNode.gain.value=this.soundVolume:this.pausedSounds[t].volume=this.soundVolume},setMusicVolume:function(e){this.musicVolume=e,this.currentMusic&&(this.context?this._audioObjects[this.currentMusic].gainNode.gain.value=this.musicVolume:this.currentMusic.volume=this.musicVolume)},setPlaybackRate:function(e,t){if(this.context){var i=this._audioObjects[e];i&&(i.playbackRate.value=t||1)}},isSoundPlaying:function(e){return-1!==this.playingSounds.indexOf(e)?!0:!1},isMusicPlaying:function(){return!!this.currentMusic},toggleSound:function(){return this.soundMuted=!this.soundMuted,this.soundMuted?this.muteSound():this.unmuteSound(),this.soundMuted},toggleMusic:function(){return this.musicMuted=!this.musicMuted,this.musicMuted?this.muteMusic():this.unmuteMusic(),this.musicMuted},_decode:function(e,t,i){this.context.decodeAudioData(e.response,this._loaded.bind(this,t,i),this._error.bind(this,t))},_load:function(e,t){var i=e.split("?").shift().split(".").pop();-1===this.formats.indexOf(i)&&(i=this.formats[0]);var s=e.replace(/[^\.]+$/,i+game._nocache);if(this.context){var n=new XMLHttpRequest;n.open("GET",s,!0),n.responseType="arraybuffer",n.onload=this._decode.bind(this,n,e,t),n.send()}else{var a=new Audio(s);game.device.ie?this._loaded(e,t,a):(a.loadCallback=this._loaded.bind(this,e,t,a),a.addEventListener("canplaythrough",a.loadCallback),a.addEventListener("error",this._error.bind(this,e))),a.preload="auto",a.load()}},_error:function(e){throw"Error loading audio "+e},_loaded:function(e,t,i){for(var s in game.paths)if(game.paths[s]===e){var n=s;break}this._sources[n]={audio:i,path:e},this.context||(i.removeEventListener("canplaythrough",i.loadCallback),i.addEventListener("ended",function(){this.playing=!1})),"function"==typeof t&&t(e)},_onended:function(e){var t=this.playingSounds.indexOf(e);-1!==t&&this.playingSounds.splice(t,1),e===this.currentMusic&&(this.currentMusic=null,this.currentMusicName=null);var i=this._audioObjects[e];return i?("function"==typeof i.callback&&i.callback(),delete this._audioObjects[e]):!1},_fade:function(e,t,i){var s=this._audioObjects[e];if(!s)return!1;if(t=(t||1e3)/1e3,!this.context)return!1;var n=this.context.currentTime;1===i&&(s.gainNode.gain.value=0);var a=s.gainNode.gain.value;return s.gainNode.gain.linearRampToValueAtTime(a,n),s.gainNode.gain.linearRampToValueAtTime(i,n+t),!0},_play:function(e,t,i,s,n,a,r){if(!game.Audio.enabled)return!1;if("number"!=typeof r&&(r=this._audioId++),this.context){var o=this.context.createBufferSource();o.buffer=this._sources[e].audio,o.loop=!!t,o.playbackRate.value=n||1,o.callback=s,o.onended=this._onended.bind(this,r);var h=this.context.createGain?this.context.createGain():this.context.createGainNode();h.gain.value="number"==typeof i?i:1,h.connect(this.gainNode),o.connect(h),o.gainNode=h;var u=o.start?"start":"noteOn";a?o[u](0,a):o[u](0),o.startTime=this.context.currentTime-(a||0)}else{var o=this._sources[e].audio;o.volume="number"==typeof i?i:1,o.loop=!!t,o.playing=!0,o.callback=s,o.onended=this._onended.bind(this,r),game.device.ie||(o.currentTime=0),o.play()}return o.name=e,this._audioObjects[r]=o,r},_stop:function(e,t){var i=this._audioObjects[e];if(!i)return!1;if(t&&(i.callback=null),this.context){if(i.pauseTime>=0)return!1;"function"==typeof i.stop?i.stop(0):i.noteOff(0)}else i.pause(),i.playing=!1;return!0},_pause:function(e){var t=this._audioObjects[e];return t?(this.context?(t.onended=null,"function"==typeof t.stop?t.stop(0):t.noteOff(0),t.pauseTime=(this.context.currentTime-t.startTime)%t.buffer.duration):(t.currentTime>0&&t.currentTime<t.duration||t.loop)&&t.pause(),!0):!1},_resume:function(e){var t=this._audioObjects[e];if(!t)return!1;if(this.context){if(!(t.pauseTime>=0))return!1;var i=this._getNameForAudio(t);this._play(i,t.loop,t.gainNode.gain.value,t.callback,t.playbackRate.value,t.pauseTime,e)}else{if(!t.playing)return!1;t.play()}return!0},_mute:function(e){var t=this._audioObjects[e];return t?(this.context?t.gainNode.gain.value=0:t.volume=0,!0):!1},_unmute:function(e,t){var i=this._audioObjects[e];return i?(this.context?i.gainNode.gain.value=t:i.volume=t,!0):!1},_getNameForAudio:function(e){for(var t in this._sources)if(this._sources[t].audio===e.buffer)return t},_systemPause:function(){this.pauseMusic();for(var e=this.playingSounds.length-1;e>=0;e--)this._pause(this.playingSounds[e]),this._systemPaused.push(this.playingSounds[e])},_systemResume:function(){this.resumeMusic();for(var e=this._systemPaused.length-1;e>=0;e--)this._resume(this._systemPaused[e]);this._systemPaused.length=0}}),game.addAttributes("Audio",{enabled:!0,formats:[{ext:"ogg",type:'audio/ogg; codecs="vorbis"'},{ext:"m4a",type:'audio/mp4; codecs="mp4a.40.5"'},{ext:"wav",type:"audio/wav"}],musicVolume:1,soundVolume:1,stopOnSceneChange:!0,webAudio:!0})}),game.module("engine.camera").body(function(){game.createClass("Camera",{maxSpeed:200,acceleration:3,offset:null,target:null,container:null,speed:null,scale:1,rounding:!1,sensorPosition:null,sensorWidth:0,sensorHeight:0,threshold:1,minX:null,maxX:null,minY:null,maxY:null,init:function(e,t){this.position=new game.Vector,this.speed=new game.Vector,this.offset=new game.Vector(game.system.width/2,game.system.height/2),this.sensorPosition=new game.Vector(this.offset.x,this.offset.y),this.sensorWidth=200*game.scale,this.sensorHeight=200*game.scale,"number"==typeof e&&"number"==typeof t&&this.setPosition(e,t),game.scene.addObject(this)},addTo:function(e){return this.container=e,this.container.position.set(-this.position.x,-this.position.y),this},setTarget:function(e){this.target=e,this.sensorPosition.set(this.target.position.x*this.scale,this.target.position.y*this.scale)},setPosition:function(e,t){this.position.set(e-this.offset.x,t-this.offset.y),"number"==typeof this.minX&&this.position.x<this.minX?(this.position.x=this.minX,this.speed.x=0):"number"==typeof this.maxX&&this.position.x>this.maxX&&(this.position.x=this.maxX,this.speed.x=0),"number"==typeof this.minY&&this.position.y<this.minY?(this.position.y=this.minY,this.speed.y=0):"number"==typeof this.maxY&&this.position.y>this.maxY&&(this.position.y=this.maxY,this.speed.y=0),this.container&&(this.container.position.x=-(this.rounding?this.position.x+.5|0:this.position.x),this.container.position.y=-(this.rounding?this.position.y+.5|0:this.position.y))},setSensor:function(e,t){this.sensorWidth=e,this.sensorHeight=t},moveSensor:function(){if(this.target){var e=Math.abs(this.target.width)*this.scale,t=Math.abs(this.target.height)*this.scale,i=(this.target.position.x+this.target.width/2)*this.scale,s=(this.target.position.y+this.target.height/2)*this.scale;(this.sensorWidth<e||this.sensorHeight<t)&&this.setSensor(e,t),i<this.sensorPosition.x-this.sensorWidth/2+e/2?this.sensorPosition.x=i+this.sensorWidth/2-e/2:i+(this.sensorWidth/2+e/2)>this.sensorPosition.x+this.sensorWidth&&(this.sensorPosition.x=i+(this.sensorWidth/2+e/2)-this.sensorWidth),s<this.sensorPosition.y-this.sensorHeight/2+t/2?this.sensorPosition.y=s+this.sensorHeight/2-t/2:s+(this.sensorHeight/2+t/2)>this.sensorPosition.y+this.sensorHeight&&(this.sensorPosition.y=s+(this.sensorHeight/2+t/2)-this.sensorHeight)}},moveCamera:function(){this.speed.x=(this.position.x-this.sensorPosition.x+this.offset.x).limit(-this.maxSpeed,this.maxSpeed),this.speed.y=(this.position.y-this.sensorPosition.y+this.offset.y).limit(-this.maxSpeed,this.maxSpeed),this.speed.x>this.threshold||this.speed.x<-this.threshold||this.speed.y>this.threshold||this.speed.y<-this.threshold?this.setPosition(this.position.x+this.offset.x-this.speed.x*this.acceleration*game.system.delta,this.position.y+this.offset.y-this.speed.y*this.acceleration*game.system.delta):this.speed.set(0,0)},update:function(){this.moveSensor(),this.moveCamera()}})}),game.module("engine.debug").body(function(){game.createClass("Debug",{fps:0,last:0,sprites:0,text:"",_bodies:[],_frames:0,init:function(){this.debugDiv=document.createElement("div"),this.debugDiv.id="pandaDebug",this.debugDiv.style.position="fixed",this.debugDiv.style.left="0px",this.debugDiv.style[game.Debug.position]="0px",this.debugDiv.style.zIndex=9999,this.debugDiv.style.backgroundColor=game.Debug.backgroundColor,this.debugDiv.style.color=game.Debug.textColor,this.debugDiv.style.fontFamily="Arial",this.debugDiv.style.fontSize="14px",this.debugDiv.style.width="100%",this.debugDiv.style.pointerEvents="none",document.body.appendChild(this.debugDiv),game.Sprite.inject({_render:function(e){this["super"](e),game.debug.sprites++}}),game.Graphics.inject({_render:function(e){this["super"](e),game.debug.sprites++}}),game.Container.inject({_render:function(e){this["super"](e),this._cacheAsBitmap&&game.debug.sprites++}}),game.Scene.inject({staticInit:function(){this["super"](),game.debug._bodies.length=0},_update:function(){game.debug._reset(),this["super"](),game.debug._update()},_updateRenderer:function(){if(this["super"](),game.Debug.showBodies&&game.debug._drawBodies(),game.Debug.showHitAreas&&game.debug._drawHitAreas(),game.Debug.showBounds)for(var e=0;e<this.stage.children.length;e++){var t=this.stage.children[e];game.debug._drawBounds(t)}}}),game.World.inject({addBody:function(e){this["super"](e),game.debug._bodies.push(e)},removeBody:function(e){this["super"](e),game.debug._bodies.erase(e)}})},_drawBodies:function(){for(var e=0;e<this._bodies.length;e++)this._drawBody(this._bodies[e])},_drawBody:function(e){if(!game.renderer.webGL&&e.world&&e.shape){var t=game.renderer.context,i=e.shape;t.setTransform(1,0,0,1,0,0),t.globalAlpha=game.Debug.bodyAlpha,t.fillStyle=game.Debug.bodyColor,i.width&&i.height?t.fillRect((e.position.x-i.width/2)*game.scale,(e.position.y-i.height/2)*game.scale,i.width*game.scale,i.height*game.scale):i.radius}},_drawBounds:function(e){if(!game.renderer.webGL&&e.parent){var t=game.renderer.context,i=e._getBounds(),s=i.x*game.scale,n=i.y*game.scale,a=i.width*game.scale,r=i.height*game.scale;if(t.setTransform(1,0,0,1,0,0),t.globalAlpha=game.Debug.boundAlpha,t.lineWidth=game.Debug.boundWidth,t.strokeStyle=game.Debug.boundColor,t.beginPath(),t.rect(s,n,a,r),t.stroke(),!e._cacheAsBitmap)for(var o=0;o<e.children.length;o++){var h=e.children[o];this._drawBounds(h)}}},_drawHitArea:function(e){if(!game.renderer.webGL){var t=game.renderer.context,i=e._worldTransform,s=e.hitArea,n=e._getBounds(),a=(n.x||i.tx)*game.scale,r=(n.y||i.ty)*game.scale;if(t.setTransform(1,0,0,1,a,r),t.globalAlpha=game.Debug.hitAreaAlpha,t.fillStyle=game.Debug.hitAreaColor,s){var o=i.a/e._cosCache,h=i.d/e._cosCache;a=s.x*o,r=s.y*h;var u=e.anchor.x*o/e.width||0,c=e.anchor.y*h/e.height||0,l=s.width*o,d=s.height*h;a+=e.anchor.x*o-l*u,r+=e.anchor.y*h-d*c;var m=s.width*o*game.scale,g=s.height*h*game.scale}else{a=0,r=0;var m=n.width*game.scale,g=n.height*game.scale}t.fillRect(a,r,m,g)}},_drawHitAreas:function(){for(var e=0;e<game.input.items.length;e++){var t=game.input.items[e];this._drawHitArea(t)}},_reset:function(){this.sprites=0},_update:function(){this._frames++;var e=Date.now();e>=this.last+game.Debug.frequency&&(this.fps=Math.round(1e3*this._frames/(e-this.last)),this.last=e,this._frames=0),this.text="",this._addText("FPS",this.fps),this._addText("OBJECTS",game.scene.objects.length),this._addText("SPRITES",this.sprites),game.tween&&this._addText("TWEENS",game.tween.tweens.length),game.scene.timers&&this._addText("TIMERS",game.scene.timers.length),game.scene.emitters&&this._addText("EMITTERS",game.scene.emitters.length),game.scene.world&&this._addText("BODIES",game.scene.world.bodies.length),this._addText("INPUTS",game.input.items.length),this._addText("WEBGL",!!game.renderer.webGL),this._addText("HIRES",game.scale),this._updateText()},_addText:function(e,t){this.text+=e+": "+t+" "},_updateText:function(){this.debugDiv.innerHTML=this.text}}),game.addAttributes("Debug",{enabled:!1,frequency:500,textColor:"#ff0000",backgroundColor:"rgba(0, 0, 0, 0.7)",position:"bottom",showBodies:!0,showBounds:!1,showCamera:!1,showHitAreas:!1,boundColor:"#ff0000",boundAlpha:.5,boundWidth:1,bodyColor:"#0000ff",bodyLineColor:"#ff0000",bodyAlpha:.5,cameraColor:"#ff00ff",cameraAlpha:.2,hitAreaColor:"#0000ff",hitAreaAlpha:.5});var e=document.location.href.toLowerCase();e.match(/\?debug/)&&(game.Debug.enabled=!0),e.match(/\?debugdraw/)&&(game.Debug.showBodies=!0,game.Debug.showBounds=!0,game.Debug.showHitAreas=!0),game.onStart=function(){if(this.Debug.enabled){console.log("Panda Engine "+this.version);var e=game.renderer.webGL?"WebGL":"Canvas";console.log(e+" "+this.system.width+"x"+this.system.height),console.log(this.Audio&&this.Audio.enabled?(this.audio.context?"Web":"HTML5")+" Audio engine":"Audio disabled")}}}),game.module("engine.geometry").body(function(){game.createClass("Circle",{radius:0,init:function(e){this.radius=e||this.radius}}),game.createClass("Matrix",{a:1,b:0,c:0,d:1,tx:null,ty:null,reset:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}}),game.createClass("Rectangle",{height:0,width:0,x:0,y:0,init:function(e,t,i,s){this.width=e||this.width,this.height="number"==typeof t?t:this.width,this.x=i||this.x,this.y=s||this.y}}),game.createClass("Vector",{x:0,y:0,init:function(e,t){this.set(e,t)},add:function(e,t){return this.x+=e instanceof game.Vector?e.x:e,this.y+=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},angle:function(e){return e instanceof game.Vector?Math.atan2(e.y-this.y,e.x-this.x):Math.atan2(this.y,this.x)
},angleFromOrigin:function(e){return Math.atan2(e.y,e.x)-Math.atan2(this.y,this.x)},clone:function(){return new this.constructor(this.x,this.y)},compare:function(e){return this.x===e.x&&this.y===e.y?!0:!1},copy:function(e){return this.x=e.x,this.y=e.y,this},distance:function(e){var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},divide:function(e,t){return this.x/=e instanceof game.Vector?e.x:e,this.y/=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},dot:function(e){return e instanceof game.Vector?this.x*e.x+this.y*e.y:this.x*this.x+this.y*this.y},dotNormalized:function(e){var t=this.length(),i=this.x/t,s=this.y/t;if(e instanceof game.Vector){var n=e.length(),a=e.x/n,r=e.y/n;return i*a+s*r}return i*i+s*s},length:function(){return Math.sqrt(this.dot())},limit:function(e){return this.x=this.x.limit(-e.x,e.x),this.y=this.y.limit(-e.y,e.y),this},multiply:function(e,t){return this.x*=e instanceof game.Vector?e.x:e,this.y*=e instanceof game.Vector?e.y:t||(0!==t?e:0),this},multiplyAdd:function(e,t){return this.x+=e instanceof game.Vector?e.x*t:e*t,this.y+=e instanceof game.Vector?e.y*t:e*t,this},normalize:function(){var e=this.length();return this.x/=e||1,this.y/=e||1,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),s=this.x*t-this.y*i,n=this.y*t+this.x*i;return this.x=s,this.y=n,this},round:function(e){return this.x=this.x.round(e),this.y=this.y.round(e),this},set:function(e,t){return this.x="number"==typeof e?e:this.x,this.y="number"==typeof t?t:this.x,this},subtract:function(e,t){return this.x-=e instanceof game.Vector?e.x:e,this.y-=e instanceof game.Vector?e.y:t||(0!==t?e:0),this}})}),game.module("engine.input").body(function(){game.createClass("Input",{items:[],touches:[],_mouseDownItem:null,_mouseDownTime:null,_mouseUpItem:null,_needUpdate:!1,init:function(e){var t=game.device.cocoonCanvasPlus?window:e;t.addEventListener("touchstart",this._touchstart.bind(this)),t.addEventListener("touchmove",this._touchmove.bind(this)),t.addEventListener("touchend",this._touchend.bind(this)),t.addEventListener("touchcancel",this._touchend.bind(this)),t.addEventListener("mousedown",this._mousedown.bind(this)),t.addEventListener("mousemove",this._mousemove.bind(this)),window.addEventListener("mouseup",this._mouseup.bind(this))},_calculateXY:function(e){var t=game.renderer.canvas.getBoundingClientRect(),i=(e.clientX-t.left)*(game.renderer.canvas.width/t.width),s=(e.clientY-t.top)*(game.renderer.canvas.height/t.height);e.canvasX=i/game.scale,e.canvasY=s/game.scale},_hitTest:function(e,t,i){var s=e.hitArea;if(s){var n=e._worldTransform,a=e._getBounds(),r=(a.x||n.tx)*game.scale,o=(a.y||n.ty)*game.scale,h=n.a/(e._cosCache||1),u=n.d/(e._cosCache||1),c=r+s.x*h,l=o+s.y*u,d=e.anchor.x*h/e.width||0,m=e.anchor.y*u/e.height||0,g=s.width*h,f=s.height*u;c+=e.anchor.x*h-g*d,l+=e.anchor.y*u-f*m,g=s.width*h*game.scale,f=s.height*u*game.scale}else{s=e._getBounds();var c=s.x,l=s.y,g=s.width,f=s.height}return t>=c&&i>=l&&c+g>=t&&l+f>=i},_mousedown:function(e){this._preventDefault(e),this._calculateXY(e),this._mouseDownItem=this._processEvent("mousedown",e),this._mouseDownTime=game.Timer.time,game.scene._mousedown&&!this._mouseDownItem&&game.scene._mousedown(e.canvasX,e.canvasY,e.identifier,e)},_mousemove:function(e){this._preventDefault(e),this._calculateXY(e);var t=this._processEvent("mousemove",e);this._mouseMoveItem&&this._mouseMoveItem!==t&&this._mouseMoveItem.mouseout(e.canvasX,e.canvasY,e.identifier,e),this._mouseMoveItem=t,game.scene._mousemove&&!this._mouseMoveItem&&game.scene._mousemove(e.canvasX,e.canvasY,e.identifier,e)},_mouseup:function(e){if(this._preventDefault(e),this._calculateXY(e),this._mouseUpItem=this._processEvent("mouseup",e),this._mouseDownItem&&this._mouseDownItem===this._mouseUpItem){var t=game.Timer.time-this._mouseDownTime;(0===game.Input.clickTimeout||t<game.Input.clickTimeout)&&this._mouseDownItem.click(e.canvasX,e.canvasY,e.identifier,e)}game.scene._mouseup&&!this._mouseUpItem&&game.scene._mouseup(e.canvasX,e.canvasY,e.identifier,e)},_preventDefault:function(e){e.preventDefault&&game.Input.preventDefault&&e.preventDefault()},_processEvent:function(e,t){for(var i=this.items.length-1;i>=0;i--){var s=this.items[i];if(s._interactive&&this._hitTest(s,t.canvasX,t.canvasY)&&!s[e](t.canvasX,t.canvasY,t.identifier,t))return s}},_touchend:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++){for(var i=e.changedTouches[t],s=this.touches.length-1;s>=0;s--)if(this.touches[s].identifier===i.identifier){this.touches.splice(s,1);break}this._mouseup(i)}},_touchmove:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++)this._mousemove(e.changedTouches[t])},_touchstart:function(e){this._preventDefault(e);for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];this.touches.push(i),this._mousedown(i)}},_update:function(){this._needUpdate&&(this.items.length=0,this._updateItems(game.scene.stage),this._needUpdate=!1)},_updateItems:function(e){for(var t=0;t<e.children.length;t++){var i=e.children[t];i._interactive&&this.items.push(i),i.children.length>0&&this._updateItems(i)}}}),game.addAttributes("Input",{clickTimeout:500,preventDefault:!0}),game.createClass("Keyboard",{_keysDown:[],init:function(){window.addEventListener("keydown",this._keydown.bind(this)),window.addEventListener("keyup",this._keyup.bind(this)),window.addEventListener("blur",this._resetKeys.bind(this))},down:function(e){return!!this._keysDown[e]},_keydown:function(e){if(game.Keyboard.keys[e.keyCode]||(game.Keyboard.keys[e.keyCode]=e.keyCode),this._keysDown[game.Keyboard.keys[e.keyCode]]=!0,game.scene&&game.scene.keydown){var t=game.scene.keydown(game.Keyboard.keys[e.keyCode],this.down("SHIFT"),this.down("CTRL"),this.down("ALT"));t&&e.preventDefault()}},_keyup:function(e){this._keysDown[game.Keyboard.keys[e.keyCode]]=!1,game.scene&&game.scene.keyup&&game.scene.keyup(game.Keyboard.keys[e.keyCode])},_resetKeys:function(){for(var e in this._keysDown)this._keysDown[e]=!1}}),game.addAttributes("Keyboard",{keys:{8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",44:"PRINT_SCREEN",45:"INSERT",46:"DELETE",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"NUM_ZERO",97:"NUM_ONE",98:"NUM_TWO",99:"NUM_THREE",100:"NUM_FOUR",101:"NUM_FIVE",102:"NUM_SIX",103:"NUM_SEVEN",104:"NUM_EIGHT",105:"NUM_NINE",106:"NUM_MULTIPLY",107:"NUM_PLUS",109:"NUM_MINUS",110:"NUM_PERIOD",111:"NUM_DIVISION",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:"SEMICOLON",187:"PLUS",189:"MINUS",192:"GRAVE_ACCENT",222:"SINGLE_QUOTE"}})}),game.module("engine.loader").body(function(){game.createClass("Loader",{backgroundColor:"#000",loaded:0,percent:0,started:!1,totalFiles:0,_assetQueue:[],_audioQueue:[],_callback:null,_dynamic:!0,_loadCount:0,_loaders:{png:"Image",jpg:"Image",jpeg:"Image",json:"JSON",fnt:"Font"},_readyTime:0,_startTime:0,init:function(e){this.onComplete=e;for(var t=0;t<game.assetQueue.length;t++)this._assetQueue.push(this._getFilePath(game.assetQueue[t]));if(game.assetQueue.length=0,game.Audio&&game.Audio.enabled){for(var t=0;t<game.audioQueue.length;t++)this._audioQueue.push(game.audioQueue[t]);game.audioQueue.length=0}this.totalFiles=this._assetQueue.length+this._audioQueue.length,0===this.totalFiles&&(this.percent=100)},onStart:function(){if(!this._dynamic){var e=game.Loader.barWidth,t=game.Loader.barHeight,i=new game.Graphics;i.beginFill(game.Loader.barBgColor),i.drawRect(0,0,e,t),i.position.set(game.system.width/2-e/2,game.system.height/2-t/2),i.addTo(this.stage),this.barFg=new game.Graphics,this.barFg.beginFill(game.Loader.barColor),this.barFg.drawRect(0,0,e,t),this.barFg.position.set(game.system.width/2-e/2,game.system.height/2-t/2),this.barFg.addTo(this.stage),this.onProgress()}},onProgress:function(){this.barFg&&(this.barFg.scale.x=this.percent/100)},onComplete:function(){},start:function(){this.started=!0,"string"==typeof this.onComplete&&(this._dynamic=!1),this._dynamic||(this._startTime=game.Timer.time,game.tween&&game.tween.removeAll(),game.system.stage&&game.system.stage.removeAll(),this.stage=new game.Container,game.scene=this,game.system._running||game.system._startRunLoop()),this.onStart(),100===this.percent?this._ready():this._startLoading()},_startLoading:function(){for(var e=this._assetQueue.length-1;e>=0;e--){var t=this._assetQueue[e];if(t){var i=t.split("?").shift().split(".").pop().toLowerCase();if(!this._loaders[i])throw"Unsupported file type "+i;if(this._loadCount++,this._assetQueue.splice(e,1),this["_load"+this._loaders[i]](t,this._progress.bind(this)),this._loadCount===game.Loader.maxFiles)return}}for(var e=this._audioQueue.length-1;e>=0;e--){var s=this._audioQueue[e];if(s&&(this._loadCount++,this._audioQueue.splice(e,1),game.audio._load(s,this._progress.bind(this)),this._loadCount===game.Loader.maxFiles))return}},_loadImage:function(e,t){game.BaseTexture.fromImage(e,t)},_loadFont:function(e,t){this._loadFile(e,this._parseXML.bind(this,e),t)},_loadJSON:function(e,t){this._loadFile(e,this._parseJSON.bind(this,e),t)},_loadFile:function(e,t,i){var s=new XMLHttpRequest;s.onload=t.bind(this,s,i),s.open("GET",e,!0),s.send()},_parseXML:function(e,t,i){if(!t.responseText||404===t.status)throw"Error loading XML "+e;var s=t.responseXML;if(!s||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var n=new DOMParser;s=n.parseFromString(t.responseText,"text/xml")}else{var a=document.createElement("div");a.innerHTML=t.responseText,s=a}var r=s.getElementsByTagName("page")[0].getAttribute("file"),o=game._getFilePath(r);this._loadImage(o,this._parseFont.bind(this,s,i))},_parseFont:function(e,t){game.Font.fromData(e),t()},_parseJSON:function(e,t,i){if(!t.responseText||404===t.status)throw"Error loading JSON "+e;var s=JSON.parse(t.responseText);if(game.json[e]=s,s.frames){var n=game._getFilePath(s.meta.image);this._loadImage(n,this._parseSpriteSheet.bind(this,s,i))}else i()},_parseSpriteSheet:function(e,t){var i=game._getFilePath(e.meta.image),s=game.BaseTexture.fromImage(i),n=e.frames;for(var a in n){var r=n[a].frame||n[a],o=new game.Texture(s,r.x,r.y,r.w,r.h);game.Texture.cache[a]=o}t()},_progress:function(){this._loadCount--,this.loaded++,this.percent=Math.round(this.loaded/this.totalFiles*100),this.onProgress(),100===this.percent?this._ready():this._startLoading()},_ready:function(){if(game.system.hires||game.system.retina)for(var e in game.BaseTexture.cache)-1!==e.indexOf("@"+game.scale+"x")&&(game.BaseTexture.cache[e.replace("@"+game.scale+"x","")]=game.BaseTexture.cache[e],delete game.BaseTexture.cache[e]);if(this._dynamic)this.onComplete();else{var t=game.Timer.time-this._startTime,i=game.Loader.time-t;100>i&&(i=100),this._readyTime=game.Timer.time+i}},_update:function(){this._dynamic||(100===this.percent&&game.Timer.time>=this._readyTime&&game.system.setScene(this.onComplete),game.renderer._render(this.stage))},_getFilePath:function(e){return game.system.retina||game.system.hires?e.replace(/\.(?=[^.]*$)/,"@"+game.scale+"x."):e}}),game.addAttributes("Loader",{time:200,barColor:"#e6e7e8",barBgColor:"#515e73",barWidth:200,barHeight:20,maxFiles:4,className:"Loader"})}),game.module("engine.particle").body(function(){game.createClass("Emitter",{particles:[],textures:[],container:null,position:null,positionVar:null,angle:0,angleVar:0,speed:100,speedVar:0,life:2e3,lifeVar:0,duration:0,durationTimer:0,rate:100,rateTimer:0,count:10,active:!0,velRotate:0,velRotateVar:0,rotate:0,rotateVar:0,startAlpha:1,endAlpha:1,startScale:1,startScaleVar:0,endScale:1,endScaleVar:0,target:null,targetForce:0,accelAngle:Math.PI/2,accelAngleVar:0,accelSpeed:0,accelSpeedVar:0,spriteSettings:{anchor:{x:.5,y:.5}},velocityLimit:null,callback:null,init:function(e){game.pool.create(game.Emitter.poolName),this.position=new game.Vector,this.positionVar=new game.Vector,this.velocityLimit=new game.Vector,this.target=new game.Vector,game.merge(this,e)},onComplete:function(e){this.callback=e},reset:function(e){for(var t in this)"number"==typeof this[t]&&(this[t]=game.Emitter.prototype[t]),this[t]instanceof game.Vector&&e&&this[t].set(0,0)},getVariance:function(e){return Math.random()*e*(Math.random()>.5?-1:1)},addParticle:function(){var e=game.pool.get(game.Emitter.poolName);e||(e=new game.Particle),e.position.x=this.position.x+this.getVariance(this.positionVar.x),e.position.y=this.position.y+this.getVariance(this.positionVar.y);var t=this.getVariance(this.angleVar),i=this.angle+t,s=this.speed+this.getVariance(this.speedVar);e.setVelocity(i,s),this.angleVar!==this.accelAngleVar&&(t=this.getVariance(this.accelAngleVar)),i=this.accelAngle+t,s=this.accelSpeed+this.getVariance(this.accelSpeedVar),e.setAccel(i,s),e.life=this.life+this.getVariance(this.lifeVar),e.sprite?(e.sprite.setTexture(this.textures.random()),e.sprite.position.x=e.position.x,e.sprite.position.y=e.position.y,e.sprite.rotation=0):e.sprite=new game.Sprite(this.textures.random(),e.position.x,e.position.y,this.spriteSettings),e.rotate=this.rotate+this.getVariance(this.rotateVar),e.velRotate=this.velRotate+this.getVariance(this.velRotateVar),this.startAlpha!==this.endAlpha?(e.deltaAlpha=this.endAlpha-this.startAlpha,e.deltaAlpha/=e.life/1e3):e.deltaAlpha=0,e.sprite.alpha=this.startAlpha;var n=this.startScale+this.getVariance(this.startScaleVar);this.startScale!==this.endScale?(e.deltaScale=this.endScale+this.getVariance(this.endScaleVar)-n,e.deltaScale/=e.life/1e3):e.deltaScale=0,e.sprite.scale.x=e.sprite.scale.y=n,this.container&&this.container.addChild(e.sprite),this.particles.push(e)},updateParticle:function(e){if(e.life>0&&(e.life-=1e3*game.system.delta,e.life<=0))return this.removeParticle(e);if(this.targetForce>0){e.accel.set(this.target.x-e.position.x,this.target.y-e.position.y);var t=Math.sqrt(e.accel.x*e.accel.x+e.accel.y*e.accel.y);e.accel.x/=t||1,e.accel.y/=t||1,e.accel.x*=this.targetForce,e.accel.y*=this.targetForce}if(e.velocity.x+=e.accel.x*game.system.delta,e.velocity.y+=e.accel.y*game.system.delta,(this.velocityLimit.x>0||this.velocityLimit.y>0)&&(e.velocity.x=e.velocity.x.limit(-this.velocityLimit.x,this.velocityLimit.x),e.velocity.y=e.velocity.y.limit(-this.velocityLimit.y,this.velocityLimit.y)),e.velRotate){var i=Math.cos(e.velRotate*game.system.delta),s=Math.sin(e.velRotate*game.system.delta),n=e.velocity.x*i-e.velocity.y*s,a=e.velocity.y*i+e.velocity.x*s;e.velocity.set(n,a)}e.position.x+=e.velocity.x*game.scale*game.system.delta,e.position.y+=e.velocity.y*game.scale*game.system.delta,e.deltaAlpha&&(e.sprite.alpha=Math.max(0,e.sprite.alpha+e.deltaAlpha*game.system.delta)),e.deltaScale&&(e.sprite.scale.x=e.sprite.scale.y+=e.deltaScale*game.system.delta),e.sprite.rotation+=e.rotate*game.system.delta,e.sprite.position.x=e.position.x,e.sprite.position.y=e.position.y},removeParticle:function(e){e.sprite.remove(),game.pool.put(game.Emitter.poolName,e),this.particles.erase(e)},emit:function(e){e=e||1;for(var t=0;e>t;t++)this.addParticle()},remove:function(){this._remove=!0},addTo:function(e){return this.container=e,this},_update:function(){if(this._remove)for(var e=this.particles.length-1;e>=0;e--)this.removeParticle(this.particles[e]);else{this.durationTimer+=1e3*game.system.delta,this.duration>0&&(this.active=this.durationTimer<this.duration,this.active||0!==this.particles.length||"function"!=typeof this.callback||(this.callback(),this.callback=null)),this.rate&&this.active&&(this.rateTimer+=1e3*game.system.delta,this.rateTimer>=this.rate&&(this.rateTimer=0,this.emit(this.count)));for(var e=this.particles.length-1;e>=0;e--)this.updateParticle(this.particles[e])}}}),game.addAttributes("Emitter",{poolName:"emitter"}),game.createClass("Particle",{position:null,velocity:null,sprite:null,accel:null,staticInit:function(){this.position=new game.Vector,this.velocity=new game.Vector,this.accel=new game.Vector},setVelocity:function(e,t){this.velocity.x=Math.cos(e)*t,this.velocity.y=Math.sin(e)*t},setAccel:function(e,t){this.accel.x=Math.cos(e)*t,this.accel.y=Math.sin(e)*t}})}),game.module("engine.physics").body(function(){game.createClass("World",{gravity:null,bodies:[],_collisionGroups:{},_solver:null,init:function(e,t){e="number"==typeof e?e:0,t="number"==typeof t?t:980,this.gravity=new game.Vector(e,t),this._solver=new game.CollisionSolver},addBody:function(e){e.world=this,e._remove=!1,this.bodies.push(e),this._addBodyCollision(e)},removeBody:function(e){e.world&&(e.world=null,e._remove=!0)},_addBodyCollision:function(e){"number"==typeof e.collisionGroup&&(this._collisionGroups[e.collisionGroup]=this._collisionGroups[e.collisionGroup]||[],-1===this._collisionGroups[e.collisionGroup].indexOf(e)&&this._collisionGroups[e.collisionGroup].push(e))},_removeBodyCollision:function(e){"number"==typeof e.collisionGroup&&this._collisionGroups[e.collisionGroup]&&-1!==this._collisionGroups[e.collisionGroup].indexOf(e)&&this._collisionGroups[e.collisionGroup].erase(e)},_collide:function(e){var t,i,s,n;for(t=0;t<e.collideAgainst.length;t++)if(e._collides.length=0,n=this._collisionGroups[e.collideAgainst[t]]){for(i=n.length-1;i>=0&&n;i--)s=n[i],e!==s&&this._solver.hitTest(e,s)&&e._collides.push(s);for(i=e._collides.length-1;i>=0;i--)this._solver.hitResponse(e,e._collides[i])&&e.afterCollide(e._collides[i])}},_update:function(){var e,t;for(e=this.bodies.length-1;e>=0;e--)this.bodies[e]._remove?(this._removeBodyCollision(this.bodies[e]),this.bodies.splice(e,1)):this.bodies[e]._update();for(e in this._collisionGroups)if(0!==this._collisionGroups[e].length)for(t=this._collisionGroups[e].length-1;t>=0;t--)this._collisionGroups[e][t]&&this._collisionGroups[e][t].collideAgainst.length>0&&this._collide(this._collisionGroups[e][t]);else delete this._collisionGroups[e]}}),game.createClass("CollisionSolver",{hitTest:function(e,t){if(e.shape.width&&t.shape.width)return!(e.position.y+e.shape.height/2<=t.position.y-t.shape.height/2||e.position.y-e.shape.height/2>=t.position.y+t.shape.height/2||e.position.x-e.shape.width/2>=t.position.x+t.shape.width/2||e.position.x+e.shape.width/2<=t.position.x-t.shape.width/2);if(e.shape.radius&&t.shape.radius)return e.shape.radius+t.shape.radius>e.position.distance(t.position);if(e.shape.width&&t.shape.radius||e.shape.radius&&t.shape.width){var i=e.shape.width?e:t,s=e.shape.radius?e:t,n=Math.max(i.position.x-i.shape.width/2,Math.min(i.position.x+i.shape.width/2,s.position.x)),a=Math.max(i.position.y-i.shape.height/2,Math.min(i.position.y+i.shape.height/2,s.position.y)),r=Math.pow(s.position.x-n,2)+Math.pow(s.position.y-a,2);return r<s.shape.radius*s.shape.radius}return!1},hitResponse:function(e,t){if(e.shape.width&&t.shape.width){if(e._last.y+e.shape.height/2<=t._last.y-t.shape.height/2){if(e.collide(t,"DOWN"))return e.position.y=t.position.y-t.shape.height/2-e.shape.height/2,!0}else if(e._last.y-e.shape.height/2>=t._last.y+t.shape.height/2){if(e.collide(t,"UP"))return e.position.y=t.position.y+t.shape.height/2+e.shape.height/2,!0}else if(e._last.x+e.shape.width/2<=t._last.x-t.shape.width/2){if(e.collide(t,"RIGHT"))return e.position.x=t.position.x-t.shape.width/2-e.shape.width/2,!0}else if(e._last.x-e.shape.width/2>=t._last.x+t.shape.width/2){if(e.collide(t,"LEFT"))return e.position.x=t.position.x+t.shape.width/2+e.shape.width/2,!0}else if(e.collide(t))return!0}else if(e.shape.radius&&t.shape.radius){var i=t.position.angle(e.position);if(e.collide(t,i)){var s=e.shape.radius+t.shape.radius;return e.position.x=t.position.x+Math.cos(i)*s,e.position.y=t.position.y+Math.sin(i)*s,!0}}else if(e.collide(t))return!0;return!1}}),game.createClass("Body",{world:null,shape:null,position:null,velocity:null,velocityLimit:null,mass:1,collisionGroup:0,collideAgainst:[],force:null,damping:0,_last:null,_collides:[],init:function(e){this.force=new game.Vector,this.position=new game.Vector,this.velocity=new game.Vector,this.velocityLimit=new game.Vector(980,980),this._last=new game.Vector,game.merge(this,e)},addShape:function(e){return this.shape=e,this},collide:function(){return!0},afterCollide:function(){},setCollisionGroup:function(e){return this.world&&"number"==typeof this.collisionGroup&&this.world._removeBodyCollision(this),this.collisionGroup=e,this.world&&this.world._addBodyCollision(this),this},setCollideAgainst:function(){this.collideAgainst.length=0;for(var e=0;e<arguments.length;e++)this.collideAgainst.push(arguments[e]);return this},addTo:function(e){return this.world?void 0:(e.addBody(this),this)},remove:function(){return this.world&&this.world.removeBody(this),this},removeCollision:function(){return this.world&&this.world._removeBodyCollision(this),this},_update:function(){this._last.copy(this.position),0!==this.mass&&this.velocity.multiplyAdd(this.world.gravity,this.mass*game.system.delta),this.velocity.multiplyAdd(this.force,game.system.delta),this.damping>0&&this.damping<1&&this.velocity.multiply(Math.pow(1-this.damping,game.system.delta)),this.velocityLimit.x>0&&(this.velocity.x=this.velocity.x.limit(-this.velocityLimit.x,this.velocityLimit.x)),this.velocityLimit.y>0&&(this.velocity.y=this.velocity.y.limit(-this.velocityLimit.y,this.velocityLimit.y)),this.position.multiplyAdd(this.velocity,game.system.delta)}})}),game.module("engine.pool").body(function(){game.createClass("Pool",{create:function(e){return this[e]?!1:(this[e]=[],!0)},get:function(e){return this[e]&&0!==this[e].length?this[e].pop():!1},put:function(e,t){return this[e]?(this[e].push(t),!0):!1}})}),game.module("engine.renderer.animation").require("engine.renderer.sprite").body(function(){game.createClass("Animation","Sprite",{anims:{},currentAnim:"default",currentFrame:0,playing:!1,textures:null,_frameTime:0,staticInit:function(e){if(this.textures=this.textures||e,"string"==typeof this.textures&&-1!==this.textures.indexOf("json")){var t=game.getJSON(this.textures);this.textures=[];for(var i in t.frames)this.textures.push(i)}for(var s=[],n=0;n<this.textures.length;n++){var a=this.textures[n];!a instanceof game.Texture&&(a=game.Texture.fromAsset(a)),s.push(a)}this.textures=s,this.addAnim("default"),this["super"](this.textures[0])},addAnim:function(e,t,i){if(!t)for(var t=[],s=0;s<this.textures.length;s++)t.push(s);var n=new game.AnimationData(t,i);return this.anims[e]=n,this},play:function(e,t){e=e||this.currentAnim;var i=this.anims[e];if(i)return this.playing=!0,this.currentAnim=e,"number"!=typeof t&&i.reverse&&(t=i.frames.length-1),this.gotoFrame(t||0),this},stop:function(e){return this.playing=!1,"number"==typeof e&&this.gotoFrame(e),this},gotoFrame:function(e){var t=this.anims[this.currentAnim];if(t)return this.currentFrame=e,this._frameTime=0,this.setTexture(this.textures[t.frames[e]]),this},updateAnimation:function(){var e=this.anims[this.currentAnim];if(this.playing&&(this._frameTime+=e.speed*game.system.delta),this._frameTime>=1){if(this._frameTime=0,e.random&&e.frames.length>1){for(var t=this.currentFrame;t===this.currentFrame;)var t=Math.round(Math.random(0,e.frames.length-1));return this.currentFrame=t,void this.setTexture(this.textures[e.frames[t]])}var t=this.currentFrame+(e.reverse?-1:1);t>=e.frames.length?e.loop?(this.currentFrame=0,this.setTexture(this.textures[e.frames[0]])):(this.playing=!1,e.onComplete&&e.onComplete()):0>t?e.loop?(this.currentFrame=e.frames.length-1,this.setTexture(this.textures[e.frames.last()])):(this.playing=!1,e.onComplete&&e.onComplete()):(this.currentFrame=t,this.setTexture(this.textures[e.frames[t]]))}},updateTransform:function(){this.currentAnim&&this.updateAnimation(),this["super"]()}}),game.addAttributes("Animation",{fromFrames:function(e){var t=[];for(var i in game.Texture.cache)0===i.indexOf(e)&&t.push(game.Texture.cache[i]);return t.length>0?new game.Animation(t):void 0}}),game.createClass("AnimationData",{loop:!0,onComplete:null,random:!1,reverse:!1,speed:10,frames:null,staticInit:function(e,t){this.frames=e,game.merge(this,t)}})}),game.module("engine.renderer.container").require("engine.geometry").body(function(){game.createClass("Container",{anchor:null,alpha:1,children:[],hitArea:null,interactive:!1,parent:null,position:null,renderable:!0,rotation:0,scale:null,stage:null,visible:!0,_cacheAsBitmap:!1,_cachedSprite:null,_cosCache:1,_interactive:!1,_rotationCache:0,_sinCache:0,_worldAlpha:1,_worldBounds:null,_worldTransform:null,staticInit:function(){this.position=new game.Vector,this.scale=new game.Vector(1,1),this.anchor=new game.Vector,this._worldTransform=new game.Matrix,this._worldBounds=new game.Rectangle},addChild:function(e){var t=this.children.indexOf(e);if(-1===t)return e.parent&&e.remove(),this.children.push(e),e.parent=this,this.stage&&e._setStageReference(this.stage),this},addTo:function(e){return e.addChild(this),this},anchorCenter:function(){return this.anchor.set(this.width/2,this.height/2),this},center:function(e,t,i){if(e){if(e===this.stage)var s=game.system.width/2,n=game.system.height/2;else var a=e._getBounds(),s=a.x+a.width/2,n=a.y+a.height/2;return s+=this.anchor.x*this.scale.x,n+=this.anchor.y*this.scale.y,s-=this.width*this.scale.x/2,n-=this.height*this.scale.y/2,t=t||0,i=i||0,this.position.set(s+t,n+i),this}},click:function(){},mousedown:function(){return!0},mousemove:function(){return!0},mouseout:function(){return!0},mouseup:function(){return!0},remove:function(){return this.parent&&this.parent.removeChild(this),this},removeAll:function(){for(var e=this.children.length-1;e>=0;e--)this.children[e].remove();return this},removeChild:function(e){var t=this.children.indexOf(e);if(-1!==t)return this.children.splice(t,1),e.parent=null,this.stage&&e._removeStageReference(),this},swap:function(e){return this.parent?(this.parent.swapChildren(this,e),this):void 0},swapChildren:function(e,t){if(e!==t){var i=this.children.indexOf(e),s=this.children.indexOf(t);0>i||0>s||(this.children[i]=t,this.children[s]=e)}},_updateChildTransform:function(){for(var e=this.children.length-1;e>=0;e--){var t=this.children[e];!t.visible||t.alpha<=0||t.updateTransform()}},updateTransform:function(){if(!this.parent)return this._updateChildTransform();var e=this.parent._worldTransform,t=this._worldTransform;this._rotationCache!==this.rotation&&(this._rotationCache=this.rotation,this._sinCache=Math.sin(this.rotation),this._cosCache=Math.cos(this.rotation));var i=this.anchor.x,s=this.anchor.y,n=this._cosCache*this.scale.x,a=this._sinCache*this.scale.x,r=-this._sinCache*this.scale.y,o=this._cosCache*this.scale.y,h=this.position.x-(i*n+s*r),u=this.position.y-(i*a+s*o);t.a=n*e.a+a*e.c,t.b=n*e.b+a*e.d,t.c=r*e.a+o*e.c,t.d=r*e.b+o*e.d,t.tx=h*e.a+u*e.c+e.tx,t.ty=h*e.b+u*e.d+e.ty,this._worldAlpha=this.parent._worldAlpha*this.alpha,this._cachedSprite?this._cachedSprite._worldAlpha=this._worldAlpha:this._updateChildTransform()},_updateParentTransform:function(){this.parent?this.parent._updateParentTransform():this.updateTransform()},_destroyCachedSprite:function(){this._cachedSprite&&this._cachedSprite.texture.remove(),this._cachedSprite=null},_generateCachedSprite:function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=this.width*game.scale,e.height=this.height*game.scale,this._worldTransform.reset(),this._updateChildTransform(),this._renderChildren(t);var i=game.Texture.fromCanvas(e),s=new game.Sprite(i);this._cachedSprite=s},_getBounds:function(){if(!this.children.length)return game.Container._emptyBounds;if(null===this._worldTransform.tx&&this._updateParentTransform(),this._cachedSprite)return this._worldBounds.x=this._worldTransform.tx+this._cachedSprite.position.x,this._worldBounds.y=this._worldTransform.ty+this._cachedSprite.position.y,this._worldBounds.width=this._cachedSprite.texture.width*this._worldTransform.a/game.scale,this._worldBounds.height=this._cachedSprite.texture.height*this._worldTransform.d/game.scale,this._worldBounds;for(var e=this._worldTransform.tx,t=this._worldTransform.ty,i=this._worldTransform.tx,s=this._worldTransform.ty,n=0;n<this.children.length;n++){var a=this.children[n],r=a._getBounds(),o=r.x+r.width,h=r.y+r.height;r.x<e&&(e=r.x),r.y<t&&(t=r.y),o>i&&(i=o),h>s&&(s=h)}return this._worldBounds.x=e,this._worldBounds.y=t,this._worldBounds.width=i-e,this._worldBounds.height=s-t,this._worldBounds},_removeStageReference:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t._removeStageReference()}this._interactive&&(game.input._needUpdate=!0),this.stage=null},_render:function(e){return this._cachedSprite?this._renderCachedSprite(e):(game.renderer.webGL&&e===game.renderer.context?this._renderWebGL():this._renderCanvas(e),void this._renderChildren(e))},_renderCachedSprite:function(e){if(game.renderer.webGL)game.renderer._spriteBatch.render(this._cachedSprite,this._worldTransform);else{e.globalAlpha=this._worldAlpha;var t=this._cachedSprite.texture,i=this._worldTransform,s=i.tx*game.scale,n=i.ty*game.scale;game.Renderer.roundPixels&&(s=0|s,n=0|n),e.setTransform(i.a,i.b,i.c,i.d,s,n),e.drawImage(t.baseTexture.source,t.position.x,t.position.y,t.width,t.height,0,0,t.width,t.height)}},_renderCanvas:function(){},_renderChildren:function(e){for(var t=0;t<this.children.length;t++){var i=this.children[t];!i.visible||i.alpha<=0||!i.renderable||i._render(e)}},_renderWebGL:function(){},_setStageReference:function(e){this.stage=e,this._interactive&&(game.input._needUpdate=!0);for(var t=0;t<this.children.length;t++){var i=this.children[t];i._setStageReference(e)}}}),game.addAttributes("Container",{_emptyBounds:new game.Rectangle}),game.defineProperties("Container",{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e)}},height:{get:function(){return this._getBounds().height},set:function(e){this.scale.y=e/this.height}},interactive:{get:function(){return this._interactive},set:function(e){this._interactive!==e&&(this._interactive=e,this.stage&&(game.input._needUpdate=!0))}},width:{get:function(){return this._getBounds().width},set:function(e){this.scale.x=e/this.width}},x:{get:function(){return this.position.x},set:function(e){this.position.x=e}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e}}})}),game.module("engine.renderer.core").require("engine.renderer.animation","engine.renderer.container","engine.renderer.graphics","engine.renderer.sprite","engine.renderer.spritesheet","engine.renderer.text","engine.renderer.texture","engine.renderer.tilingsprite","engine.renderer.webgl").body(function(){game.createClass("Renderer",{canvas:null,context:null,webGL:!1,_offset:null,_projection:null,_shaderManager:null,_smoothProperty:null,_spriteBatch:null,_webGLClearColor:{r:0,g:0,b:0},init:function(){this.canvas=document.getElementById(game.System.canvasId),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id=game.System.canvasId,document.body.style.margin=0,document.body.appendChild(this.canvas),this._show());var e=!1;try{var t=document.createElement("canvas");e=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(i){}if(e&&game.Renderer.webGL){this.webGL=!0,this.context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");var s=this.context;s.id=0,s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.blendFunc(1,771),this._projection=new game.Vector,this._offset=new game.Vector,this._shaderManager=new game.WebGLShaderManager,this._spriteBatch=new game.WebGLSpriteBatch,this._shaderManager.setContext(s),this._spriteBatch.setContext(s)}else this.context=this.canvas.getContext("2d"),"imageSmoothingEnabled"in this.context?this._smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this._smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this._smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this._smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this._smoothProperty="msImageSmoothingEnabled");
this._resize(game.system.canvasWidth,game.system.canvasHeight)},_clear:function(){if(this.webGL){var e=this._webGLClearColor;game.scene.backgroundColor&&(game.scene._backgroundColorRgb||(game.scene._backgroundColorRgb=this._hexToRgb(game.scene.backgroundColor)),e=game.scene._backgroundColorRgb),this.context.clearColor(e.r,e.g,e.b,1),this.context.clear(this.context.COLOR_BUFFER_BIT)}else game.scene.backgroundColor?(this.context.fillStyle=game.scene.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},_hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,s){return t+t+i+i+s+s});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},_hide:function(){this.canvas.style.display="none"},_position:function(e,t){this.canvas.style.position="absolute",this.canvas.style.left=e+"px",this.canvas.style.top=t+"px"},_render:function(e){this.webGL?(this.context.viewport(0,0,this.canvas.width,this.canvas.height),this.context.bindFramebuffer(this.context.FRAMEBUFFER,null),this._projection.x=this.canvas.width/2,this._projection.y=-this.canvas.height/2):(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1),game.Renderer.clearBeforeRender&&this._clear(),e.updateTransform(),this._spriteBatch&&this._spriteBatch.begin(this),e._render(this.context),this._spriteBatch&&this._spriteBatch.end()},_resize:function(e,t){this.canvas.width=e,this.canvas.height=t,this._smoothProperty&&(this.context[this._smoothProperty]="linear"===game.Renderer.scaleMode)},_show:function(){this.canvas.style.display="block"},_size:function(e,t){this.canvas.style.width=e+"px",this.canvas.style.height=t+"px"},_updateTexture:function(e){if(e.loaded){var t=this.context;return e._glTextures[t.id]||(e._glTextures[t.id]=t.createTexture()),t.bindTexture(t.TEXTURE_2D,e._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e._premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,"linear"===game.Renderer.scaleMode?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,"linear"===game.Renderer.scaleMode?t.LINEAR:t.NEAREST),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),e._dirty[t.id]=!1,e._glTextures[t.id]}}}),game.addAttributes("Renderer",{clearBeforeRender:!0,roundPixels:!1,webGL:!1,scaleMode:"linear"})}),game.module("engine.renderer.graphics").require("engine.renderer.container").body(function(){game.createClass("Graphics","Container",{fillColor:"#fff",fillAlpha:1,lineAlpha:1,lineColor:"#fff",lineWidth:0,shapes:[],beginFill:function(e,t){return this.fillColor=e||this.fillColor,this.fillAlpha=t||this.fillAlpha,this},clear:function(){return this.shapes.length=0,this},drawRect:function(e,t,i,s){i*=game.scale,s*=game.scale;var n=new game.Rectangle(i,s,e,t);return this._drawShape(n),this},lineStyle:function(e,t,i){return this.lineWidth=e||this.lineWidth,this.lineColor=t||this.lineColor,this.lineAlpha=i||this.lineAlpha,this},_drawShape:function(e){var t=new game.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,e);this.shapes.push(t)},_getBounds:function(){null===this._worldTransform.tx&&this.updateParentTransform();for(var e=this._worldTransform.tx,t=this._worldTransform.ty,i=this._worldTransform.tx,s=this._worldTransform.ty,n=0;n<this.shapes.length;n++){var a=this.shapes[n],r=this._worldTransform.tx+a.shape.x,o=this._worldTransform.ty+a.shape.y;if(a.shape instanceof game.Rectangle)var h=r+a.shape.width,u=o+a.shape.height;e>r&&(e=r),t>o&&(t=o),h>i&&(i=h),u>s&&(s=u)}return this._worldBounds.x=e,this._worldBounds.y=t,this._worldBounds.width=i-e,this._worldBounds.height=s-t,this._worldBounds},_renderWebGL:function(){},_renderCanvas:function(e){var t=this._worldTransform.tx*game.scale,i=this._worldTransform.ty*game.scale;e.setTransform(this._worldTransform.a,this._worldTransform.b,this._worldTransform.c,this._worldTransform.d,t,i);for(var s=0;s<this.shapes.length;s++)this.shapes[s]._render(e,this._worldAlpha);this["super"](e)}}),game.defineProperties("Graphics",{width:{get:function(){return this.scale.x*this._getBounds().width/game.scale}},height:{get:function(){return this.scale.y*this._getBounds().height/game.scale}}}),game.createClass("GraphicsData",{init:function(e,t,i,s,n,a){this.lineWidth=e,this.lineColor=t,this.lineAlpha=i,this.fillColor=s,this.fillAlpha=n,this.shape=a},_render:function(e,t){game.renderer.webGL?this._renderWebGL(e,t):this._renderCanvas(e,t)},_renderCanvas:function(e,t){e.globalAlpha=this.fillAlpha*t,e.fillStyle=this.fillColor,this.shape instanceof game.Rectangle&&e.fillRect(this.shape.x,this.shape.y,this.shape.width,this.shape.height)},_renderWebGL:function(){}})}),game.module("engine.renderer.sprite").require("engine.renderer.container").body(function(){game.createClass("Sprite","Container",{texture:null,staticInit:function(e){this["super"](),this.setTexture(this.texture||e)},setTexture:function(e){return e?(this.texture=e instanceof game.Texture?e:game.Texture.fromAsset(e),this):void 0},_getBounds:function(){null===this._worldTransform.tx&&this._updateParentTransform();for(var e=this.texture.width/game.scale,t=this.texture.height/game.scale,i=this._worldTransform,s=i.a,n=i.b,a=i.c,r=i.d,o=i.tx,h=i.ty,u=s*e+o,c=n*e+h,l=s*e+a*t+o,d=r*t+n*e+h,m=a*t+o,g=r*t+h,f=Math.min(o,u,l,m),p=Math.min(h,c,d,g),_=Math.max(o,u,l,m),v=Math.max(h,c,d,g),y=0;y<this.children.length;y++){var w=this.children[y]._getBounds(),x=w.x,b=x+w.width,S=w.y,T=S+w.height;f=Math.min(f,x),p=Math.min(p,S),_=Math.max(_,b),v=Math.max(v,T)}return this._worldBounds.x=f,this._worldBounds.y=p,this._worldBounds.width=_-f,this._worldBounds.height=v-p,this._worldBounds},_render:function(e){return this.texture?(!this.texture.width&&this.texture.baseTexture.width&&(this.texture.width=this.texture.baseTexture.width),!this.texture.height&&this.texture.baseTexture.height&&(this.texture.height=this.texture.baseTexture.height),this.texture.width&&this.texture.height?void this["super"](e):this._renderChildren(e)):void 0},_renderWebGL:function(){game.renderer._spriteBatch.render(this)},_renderCanvas:function(e,t,i,s){if(this.texture.baseTexture.loaded){e.globalAlpha=this._worldAlpha;var n=this.texture,a=t||this._worldTransform,r=a.tx,o=a.ty;game.Renderer.roundPixels&&(r=0|r,o=0|o),r*=game.scale,o*=game.scale;var h=n.position.x,u=n.position.y,c=n.width,l=n.height;i&&(h=i.x,u=i.y,c=i.width,l=i.height),s&&(r+=s.x,o+=s.y),e.setTransform(a.a,a.b,a.c,a.d,r,o),e.drawImage(n.baseTexture.source,h,u,c,l,0,0,c,l)}}}),game.defineProperties("Sprite",{width:{get:function(){return this.scale.x*this.texture.width/game.scale},set:function(e){this.scale.x=e/this.texture.width}},height:{get:function(){return this.scale.y*this.texture.height/game.scale},set:function(e){this.scale.y=e/this.texture.height}}})}),game.module("engine.renderer.spritesheet").body(function(){game.createClass("SpriteSheet",{textures:[],frames:0,width:0,height:0,texture:null,_sx:0,_sy:0,staticInit:function(e,t,i){this.width=this.width||t,this.height=this.height||i;var s=game.BaseTexture.cache[game.paths[this.texture||e]];this._sx=Math.floor(s.width/this.width),this._sy=Math.floor(s.height/this.height),this.frames=this._sx*this._sy;for(var n=0;n<this.frames;n++){var a=n%this._sx*this.width,r=Math.floor(n/this._sx)*this.height,o=new game.Texture(s,a,r,this.width,this.height);this.textures.push(o)}},frame:function(e){return e=e.limit(0,this.frames-1),new game.Sprite(this.textures[e])},anim:function(e,t,i){t=t||0,e=e||this.frames;var s=[];if(e.length>0)for(var n=0;n<e.length;n++)s.push(this.textures[t+e[n]]);else for(var n=0;e>n;n++)s.push(this.textures[t+n]);return i?s:new game.Animation(s)}})}),game.module("engine.renderer.text").require("engine.renderer.sprite").body(function(){game.createClass("Text","Container",{font:null,fontClass:null,text:null,wrap:0,align:"left",_lines:null,staticInit:function(e,t){this["super"](),this.text=this.text||e.toString(),game.merge(this,t),this.font&&this.setFont(this.font)},setFont:function(e){if(this.font=e,this.fontClass=game.Font.cache[e],!this.fontClass)throw"Font "+e+" not found";return this.text&&this.setText(this.text),this},setText:function(e){return this.text=e,this.updateText(),this},updateText:function(){if(this.fontClass){this.removeAll();for(var e=0,t=1,i=[{words:[],width:0}],s=0,n=0,a=0;a<this.text.length;a++){var r=this.text.charCodeAt(a);if((32===r||10===r)&&n>0){var o=i[s].width+n;o>this.wrap&&this.wrap>0&&i[s].words.length>0&&(s++,i.push({words:[],width:0})),i[s].words.push({width:n,type:t}),i[s].width+=n}if(32!==r)if(10!==r){var h=this.fontClass.chars[r];h&&(n+=h.xadvance+h.xoffset)}else s++,i.push({words:[],width:0}),n=0;else i[s].words.push({width:this.fontClass.spaceWidth,type:e}),i[s].width+=this.fontClass.spaceWidth,n=0}if(n>0){var o=i[s].width+n;o>this.wrap&&this.wrap>0&&i[s].words.length>0&&(s++,i.push({words:[],width:0})),i[s].words.push({width:n,type:t}),i[s].width+=n}for(var u=0,a=0;a<i.length;a++){var c=i[a];c.width>u&&(u=c.width);for(var l=c.words.length-1;l>=0&&c.words[l].type===e;l--)c.width-=this.fontClass.spaceWidth}this._lines=i,this._generateText(u)}},_generateText:function(e){var t=0,i=0,s=0,n=0;"center"===this.align&&(t=e/2-this._lines[0].width/2),"right"===this.align&&(t=e-this._lines[0].width);for(var a=0;a<this.text.length;a++){var r=this._lines[s];r.words[n]||(s++,n=0,t>0&&(i+=this.fontClass.lineHeight),t=0,"center"===this.align&&(t=e/2-this._lines[s].width/2),"right"===this.align&&(t=e-this._lines[s].width));var o=this.text.charCodeAt(a);32===o&&(t>0&&(t+=this.fontClass.spaceWidth,n++),n++),10===o&&(i+=this.fontClass.lineHeight,t=0,n++);var h=this.fontClass.chars[o];if(h){var u=h.texture,c=new game.Sprite(u);c.position.x=(t+h.xoffset)/game.scale,c.position.y=(i+h.yoffset)/game.scale,this.addChild(c),t+=h.xadvance+h.xoffset}}}}),game.createClass("Font",{baseTexture:null,chars:{},lineHeight:0,spaceWidth:0,init:function(e){var t=e.getElementsByTagName("page")[0].getAttribute("file"),i=e.getElementsByTagName("info")[0],s=e.getElementsByTagName("common")[0],n=(i.getAttribute("face"),e.getElementsByTagName("char"));this.baseTexture=game.BaseTexture.fromImage(game._getFilePath(t)),this.lineHeight=parseInt(s.getAttribute("lineHeight"));for(var a=0;a<n.length;a++){var r=parseInt(n[a].getAttribute("xadvance")),o=parseInt(n[a].getAttribute("id"));if(32!==o){var h=parseInt(n[a].getAttribute("xoffset")),u=parseInt(n[a].getAttribute("yoffset")),c=parseInt(n[a].getAttribute("x")),l=parseInt(n[a].getAttribute("y")),d=parseInt(n[a].getAttribute("width")),m=parseInt(n[a].getAttribute("height")),g=new game.Texture(this.baseTexture,c,l,d,m);this.chars[o]={texture:g,xadvance:r,xoffset:h,yoffset:u}}else this.spaceWidth=r}}}),game.addAttributes("Font",{cache:{},fromData:function(e){var t=e.getElementsByTagName("info")[0],i=t.getAttribute("face"),s=game.Font.cache[i];return s||(s=new game.Font(e),game.Font.cache[i]=s),s},clearCache:function(){for(var e in this.cache)delete this.cache[e]}})}),game.module("engine.renderer.texture").body(function(){game.createClass("Texture",{baseTexture:null,height:0,position:null,width:0,_uvs:[0,0,0,0,0,0,0,0],init:function(e,t,i,s,n){this.baseTexture=e instanceof game.BaseTexture?e:game.BaseTexture.fromAsset(e),this.position=new game.Vector(t,i),this.width=s||this.baseTexture.width,this.height=n||this.baseTexture.height,game.renderer.webGL&&this._updateUvs()},remove:function(){for(var e in game.Texture.cache)if(game.Texture.cache[e]===this)return void delete game.Texture.cache[e]},_updateUvs:function(){var e=this.baseTexture.width,t=this.baseTexture.height;this._uvs[0]=this.position.x/e,this._uvs[1]=this.position.y/t,this._uvs[2]=(this.position.x+this.width)/e,this._uvs[3]=this.position.y/t,this._uvs[4]=(this.position.x+this.width)/e,this._uvs[5]=(this.position.y+this.height)/t,this._uvs[6]=this.position.x/e,this._uvs[7]=(this.position.y+this.height)/t}}),game.addAttributes("Texture",{cache:{},clearCache:function(){for(var e in this.cache)delete this.cache[e]},fromImage:function(e){var t=this.cache[e];return t||(t=new game.Texture(game.BaseTexture.fromImage(e)),this.cache[e]=t),t},fromAsset:function(e){var t=game.paths[e]||e,i=this.cache[t];return i||(i=game.Texture.fromImage(t)),i},fromCanvas:function(e){var t=this.cache[e._id];if(!t){var i=game.BaseTexture.fromCanvas(e);t=new game.Texture(i),this.cache[e._id]=t}return t}}),game.createClass("BaseTexture",{height:0,loaded:!1,source:null,width:0,_dirty:[!0,!0,!0,!0],_glTextures:[],_id:null,_loadCallback:null,_powerOf2:!1,_premultipliedAlpha:!0,init:function(e,t){this.source=e,this._loadCallback=t,e.getContext?this._onload():e.onload=this._onload.bind(this)},_onload:function(){this.loaded=!0,this.width=this.source.width,this.height=this.source.height,this._loadCallback&&this._loadCallback()}}),game.addAttributes("BaseTexture",{cache:{},_id:1,fromImage:function(e,t){var i=this.cache[e];if(!i){var s=document.createElement("img");s.src=e,i=new game.BaseTexture(s,t),i._id=e,this.cache[e]=i}return i},fromAsset:function(e){var t=game.paths[e],i=this.cache[t];return i||(i=this.fromImage(t)),i},fromCanvas:function(e){e._id||(e._id="canvas_"+this._id++);var t=this.cache[e._id];return t||(t=new game.BaseTexture(e),t._id=e._id,this.cache[e._id]=t),t},clearCache:function(){for(var e in this.cache)delete this.cache[e]}})}),game.module("engine.renderer.tilingsprite").require("engine.renderer.sprite").body(function(){game.createClass("TilingSprite","Container",{sprite:null,tilePosition:null,staticInit:function(e,t,i){this["super"](),this.tilePosition=new game.Vector,this.texture=this.texture||e;var e=this.texture instanceof game.Texture?this.texture:game.Texture.fromAsset(this.texture);this.width=t||e.width,this.height=i||e.height,this.sprite=new game.Sprite(e),this._pos=new game.Rectangle,this._rect=new game.Rectangle},_generateTexture:function(){},_renderChildren:function(e){for(var t=-(this.tilePosition.x%this.sprite.texture.width),i=-(this.tilePosition.y%this.sprite.texture.height);t<this.width&&i<this.height;)this._rect.x=0,this._rect.y=0,this._rect.width=this.sprite.texture.width,this._rect.height=this.sprite.texture.height,this._pos.x=t,this._pos.y=i,this._pos.x<0&&(this._rect.x=-this._pos.x,this._rect.width+=this._pos.x,this._pos.x=0),this._pos.y<0&&(this._rect.y=-this._pos.y,this._rect.height+=this._pos.y,this._pos.y=0),t+this._rect.width>this.width&&(this._rect.width-=t+this._rect.width-this.width),i+this._rect.height>this.height&&(this._rect.height-=i+this._rect.height-this.height),this.sprite._renderCanvas(e,this._worldTransform,this._rect,this._pos),t+=this.sprite.texture.width,t>this.width&&(t=-(this.tilePosition.x%this.sprite.texture.width),i+=this.sprite.texture.height)},update:function(){this.tilePosition.add(50*game.delta)}}),game.defineProperties("TilingSprite",{width:{get:function(){return this._width},set:function(e){this._width=e}},height:{get:function(){return this._height},set:function(e){this._height=e}}})}),game.module("engine.renderer.webgl").body(function(){game.createClass("WebGLAbstractFilter",{dirty:!0,fragmentSrc:[],padding:0,passes:[],shaders:[],uniforms:{},init:function(e,t){this.passes.push(this),this.uniforms=t||this.uniforms,this.fragmentSrc=e||this.fragmentSrc},syncUniforms:function(){for(var e=0,t=this.shaders.length;t>e;e++)this.shaders[e].dirty=!0}}),game.createClass("WebGLShader",{aVertexPosition:null,attributes:[],colorAttribute:null,context:null,dimensions:null,dirty:!0,firstRun:!0,offsetVector:null,program:null,projectionVector:null,textureCount:0,uSampler:null,uniforms:null,_UID:null,staticInit:function(e){this._UID=game.WebGLShader._UID++,this.context=e},init:function(){var e=this.context;this.program=this.compileProgram(e,this.vertexSrc||game.WebGLShader.vertexSrc,game.WebGLShader.fragmentSrc),e.useProgram(this.program),this.uSampler=e.getUniformLocation(this.program,"uSampler"),this.projectionVector=e.getUniformLocation(this.program,"projectionVector"),this.offsetVector=e.getUniformLocation(this.program,"offsetVector"),this.dimensions=e.getUniformLocation(this.program,"dimensions"),this.aVertexPosition=e.getAttribLocation(this.program,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(this.program,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(this.program,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes.push(this.aVertexPosition),this.attributes.push(this.aTextureCoord),this.attributes.push(this.colorAttribute);for(var t in this.uniforms)this.uniforms[t].uniformLocation=e.getUniformLocation(this.program,t);this.initUniforms()},initUniforms:function(){this.textureCount=1;var e,t=this.context;for(var i in this.uniforms){e=this.uniforms[i];var s=e.type;"mat2"===s||"mat3"===s||"mat4"===s?(e.glMatrix=!0,e.glValueLength=1,"mat2"===s?e.glFunc=t.uniformMatrix2fv:"mat3"===s?e.glFunc=t.uniformMatrix3fv:"mat4"===s&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+s],e.glValueLength="2f"===s||"2i"===s?2:"3f"===s||"3i"===s?3:"4f"===s||"4i"===s?4:1)}},compileProgram:function(e,t,i){var s=this.compileFragmentShader(e,i),n=this.compileVertexShader(e,t),a=e.createProgram();return e.attachShader(a,n),e.attachShader(a,s),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.log("Could not initialise shaders"),a},compileFragmentShader:function(e,t){return this.compileShader(e,t,e.FRAGMENT_SHADER)},compileVertexShader:function(e,t){return this.compileShader(e,t,e.VERTEX_SHADER)},compileShader:function(e,t,i){var s=t.join("\n"),n=e.createShader(i);return e.shaderSource(n,s),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log(e.getShaderInfoLog(n)),null)},destroy:function(){this.context.deleteProgram(this.program),this.uniforms=null,this.context=null,this.attributes.length=0},syncUniforms:function(){this.textureCount=1;var e,t=this.context;for(var i in this.uniforms)e=this.uniforms[i],1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&e._init&&(t.activeTexture(t["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty[t.id]?PIXI.instances[t.id].updateTexture(e.value.baseTexture):t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]),t.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++)}}),game.addAttributes("WebGLShader",{_UID:0,vertexSrc:["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],fragmentSrc:["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]}),game.createClass("WebGLShaderManager",{attribState:[],context:null,defaultShader:null,maxAttibs:10,stack:[],tempAttribState:[],init:function(){for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1},destroy:function(){this.attribState=null,this.tempAttribState=null,this.defaultShader.destroy(),this.context=null},setAttribs:function(e){for(var t=this.context,i=0;i<this.tempAttribState.length;i++)this.tempAttribState[i]=!1;for(var i=0;i<e.length;i++){var s=e[i];this.tempAttribState[s]=!0}for(var i=0;i<this.attribState.length;i++)this.attribState[i]!==this.tempAttribState[i]&&(this.attribState[i]=this.tempAttribState[i],this.tempAttribState[i]?t.enableVertexAttribArray(i):t.disableVertexAttribArray(i))},setContext:function(e){this.context=e,this.defaultShader=new game.WebGLShader(e),this.setShader(this.defaultShader)},setShader:function(e){return this._currentId===e._UID?!1:(this._currentId=e._UID,this.currentShader=e,this.context.useProgram(e.program),this.setAttribs(e.attributes),!0)}}),game.createClass("WebGLSpriteBatch",{blendModes:[],currentBatchSize:0,currentBaseTexture:null,dirty:!0,drawing:!1,lastIndexCount:0,size:2e3,shaders:[],sprites:[],textures:[],vertSize:5,init:function(){var e=4*this.size*4*this.vertSize,t=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(t);for(var i=0,s=0;t>i;i+=6,s+=4)this.indices[i+0]=s+0,this.indices[i+1]=s+1,this.indices[i+2]=s+2,this.indices[i+3]=s+0,this.indices[i+4]=s+2,this.indices[i+5]=s+3;this.defaultShader=new game.WebGLAbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},setContext:function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var t=new game.WebGLShader(e);t.fragmentSrc=this.defaultShader.fragmentSrc,t.uniforms={},t.init(),this.defaultShader.shaders[e.id]=t},begin:function(e){this.renderSession=e,this.shader=this.renderSession._shaderManager.defaultShader,this.start()},end:function(){this.flush()},render:function(e,t){var i=e.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var s=i._uvs;if(s){var n=(e.anchor.x,e.anchor.y,i.width),a=i.height,r=0,o=0,h=4*this.currentBatchSize*this.vertSize,u=t||e._worldTransform,c=u.a,l=u.b,d=u.c,m=u.d,g=u.tx*game.scale,f=u.ty*game.scale,p=this.colors,_=this.positions;game.Renderer.roundPixels?(_[h]=c*r+d*o+g|0,_[h+1]=m*o+l*r+f|0,_[h+5]=c*n+d*o+g|0,_[h+6]=m*o+l*n+f|0,_[h+10]=c*n+d*a+g|0,_[h+11]=m*a+l*n+f|0,_[h+15]=c*r+d*a+g|0,_[h+16]=m*a+l*r+f|0):(_[h]=c*r+d*o+g,_[h+1]=m*o+l*r+f,_[h+5]=c*n+d*o+g,_[h+6]=m*o+l*n+f,_[h+10]=c*n+d*a+g,_[h+11]=m*a+l*n+f,_[h+15]=c*r+d*a+g,_[h+16]=m*a+l*r+f),_[h+2]=s[0],_[h+3]=s[1],_[h+7]=s[2],_[h+8]=s[3],_[h+12]=s[4],_[h+13]=s[5],_[h+17]=s[6],_[h+18]=s[7];var v=16777215,y=(v>>16)+(65280&v)+((255&v)<<16)+(255*e._worldAlpha<<24);p[h+4]=p[h+9]=p[h+14]=p[h+19]=y,this.sprites[this.currentBatchSize++]=e}},flush:function(){if(0!==this.currentBatchSize){var e,t=this.gl;if(this.dirty){this.dirty=!1,t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e=this.defaultShader.shaders[t.id];var i=4*this.vertSize;t.vertexAttribPointer(e.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(e.aTextureCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(e.colorAttribute,4,t.UNSIGNED_BYTE,!0,i,16)}if(this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var s=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,s)}for(var n,a,r,o=0,h=0,u=null,c=null,l=!1,d=0,m=this.currentBatchSize;m>d;d++){if(r=this.sprites[d],n=r.texture.baseTexture,a=r.shader||this.defaultShader,l=c!==a,(u!==n||l)&&(this.renderBatch(u,o,h),h=d,o=0,u=n,l)){c=a,e=c.shaders[t.id],e||(e=new game.WebGLShader(t),e.fragmentSrc=c.fragmentSrc,e.uniforms=c.uniforms,e.init(),c.shaders[t.id]=e),this.renderSession._shaderManager.setShader(e),e.dirty&&e.syncUniforms();var g=this.renderSession._projection;t.uniform2f(e.projectionVector,g.x,g.y);var f=this.renderSession._offset;t.uniform2f(e.offsetVector,f.x,f.y)}o++}this.renderBatch(u,o,h),this.currentBatchSize=0}},renderBatch:function(e,t,i){if(0!==t){var s=this.gl;e._dirty[s.id]?this.renderSession._updateTexture(e):s.bindTexture(s.TEXTURE_2D,e._glTextures[s.id]),s.drawElements(s.TRIANGLES,6*t,s.UNSIGNED_SHORT,6*i*2)}},stop:function(){this.flush(),this.dirty=!0},start:function(){this.dirty=!0},destroy:function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null}})}),game.module("engine.scene").body(function(){game.createClass("Scene",{backgroundColor:null,objects:[],timers:[],emitters:[],stage:null,swipeDist:100,swipeTime:500,_backgroundColorRgb:null,_updateOrder:[],_mouseDownTime:null,_mouseDownX:null,_mouseDownY:null,staticInit:function(){game.audio&&game.Audio.stopOnSceneChange&&game.scene&&(game.audio.stopMusic(),game.audio.stopSound(!1,!0),game.audio.pausedSounds.length=0,game.audio.playingSounds.length=0),game.scene=this,this.stage=new game.Container,this.stage.stage=this.stage;for(var e=0;e<game.Scene.updateOrder.length;e++)this._updateOrder.push(game.Scene.updateOrder[e].ucfirst())},addObject:function(e){-1===this.objects.indexOf(e)&&(e._remove=!1,this.objects.push(e))},removeObject:function(e){e._remove=!0},addEmitter:function(e){-1===this.emitters.indexOf(e)&&this.emitters.push(e)},removeEmitter:function(e){e&&e.remove()},addTimer:function(e,t,i){var s=new game.Timer(e);return s.repeat=!!i,s.callback=t,this.timers.push(s),s},removeTimer:function(e,t){e&&(t||(e.callback=null),e.repeat=!1,e.set(0))},removeTimers:function(e){for(var t=this.timers.length-1;t>=0;t--)this.removeTimer(this.timers[t],e)},addTween:function(e,t,i,s){var n=new game.Tween(e);n.to(t,i);for(var a in s)n[a](s[a]);return n},mousedown:function(){},mousemove:function(){},mouseup:function(){},keydown:function(){},keyup:function(){},swipe:function(){},onResize:function(){},exit:function(){},update:function(){},_mousedown:function(e,t,i,s){this._mouseDownTime=game.Timer.time,this._mouseDownX=e,this._mouseDownY=t,this.mousedown(e,t,i,s)},_mousemove:function(e,t,i,s){this.mousemove(e,t,i,s),this._mouseDownTime&&(e-this._mouseDownX>=this.swipeDist?this._swipe("right"):e-this._mouseDownX<=-this.swipeDist?this._swipe("left"):t-this._mouseDownY>=this.swipeDist?this._swipe("down"):t-this._mouseDownY<=-this.swipeDist&&this._swipe("up"))},_mouseup:function(e,t,i,s){this._mouseDownTime=null,this.mouseup(e,t,i,s)},_swipe:function(e){var t=game.Timer.time-this._mouseDownTime;this._mouseDownTime=null,(t<=this.swipeTime||0===this.swipeTime)&&this.swipe(e)},_update:function(){this.update();for(var e=0;e<this._updateOrder.length;e++)this["_update"+this._updateOrder[e]]()},_updateTweens:function(){game.tween&&game.tween._update()},_updatePhysics:function(){this.world&&this.world._update()},_updateTimers:function(){for(var e=this.timers.length-1;e>=0;e--)this.timers[e].time()>=0&&("function"==typeof this.timers[e].callback&&this.timers[e].callback(),this.timers[e].repeat?this.timers[e].reset():this.timers.splice(e,1))},_updateEmitters:function(){for(var e=this.emitters.length-1;e>=0;e--)this.emitters[e]._update(),this.emitters[e]._remove&&this.emitters.splice(e,1)},_updateObjects:function(){for(var e=this.objects.length-1;e>=0;e--)"function"!=typeof this.objects[e].update||this.objects[e]._remove||this.objects[e].update(),this.objects[e]._remove&&this.objects.splice(e,1)},_updateRenderer:function(){game.renderer._render(this.stage)},_pause:function(){game.audio&&game.audio._systemPause()},_resume:function(){game.audio&&game.audio._systemResume()}}),game.addAttributes("Scene",{updateOrder:["tweens","physics","timers","emitters","objects","renderer"]})}),game.module("engine.storage").body(function(){game.createClass("Storage",{id:null,supported:null,init:function(e){this.id=e||game.Storage.id,this.supported=this._isSupported()},set:function(e,t){return this.supported?void localStorage.setItem(this.id+"."+e,this._encode(t)):!1},get:function(e,t){var i=localStorage.getItem(this.id+"."+e);if(null===i)return t;try{return this._decode(i)}catch(s){return i}},has:function(e){return null!==localStorage.getItem(this.id+"."+e)},remove:function(e){localStorage.removeItem(this.id+"."+e)},reset:function(){for(var e=localStorage.length-1;e>=0;e--){var t=localStorage.key(e);-1!==t.indexOf(this.id+".")&&localStorage.removeItem(t)}},_encode:function(e){return JSON.stringify(e)},_decode:function(e){return JSON.parse(e)},_isSupported:function(){if("object"!=typeof localStorage)return!1;try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(e){return!1}return!0}}),game.addAttributes("Storage",{id:""})}),game.module("engine.system").body(function(){game.createClass("System",{canvasHeight:0,canvasWidth:0,delta:0,height:0,hires:!1,originalHeight:0,originalWidth:0,paused:!1,retina:!1,sceneName:null,width:0,_newSceneClass:null,_pausedOnHide:!1,_rotateScreenVisible:!1,_runLoopId:0,_running:!1,init:function(){game.width=this.width=this.originalWidth=game.System.width,game.height=this.height=this.originalHeight=game.System.height;for(var e=1;e<=game.System.hires;e++){var t=game.System.hiresRatio*e;window.innerWidth>=this.originalWidth*t&&window.innerHeight>=this.originalHeight*t&&(this.hires=!0,game.scale=2*e)}game.System.retina&&2===game.device.pixelRatio&&game.scale<game.System.hires&&(this.retina=!0,game.scale*=2),this.canvasWidth=this.originalWidth*game.scale,this.canvasHeight=this.originalHeight*game.scale;var i;"undefined"!=typeof document.hidden?i="visibilitychange":"undefined"!=typeof document.mozHidden?i="mozvisibilitychange":"undefined"!=typeof document.msHidden?i="msvisibilitychange":"undefined"!=typeof document.webkitHidden&&(i="webkitvisibilitychange"),document.addEventListener(i,function(){if(game.System.pauseOnHide){var e=!!game._getVendorAttribute(document,"hidden");e?game.system.pause(!0):game.system.resume(!0)}}),game.System.resize&&(game.System.center=!1),window.addEventListener("resize",this._onWindowResize.bind(this))},resize:function(e,t){(this.width!==e||this.height!==t)&&(game.width=this.width=e/game.scale,game.height=this.height=t/game.scale,game.renderer._resize(e,t),game.scene&&game.scene.onResize&&game.scene.onResize())},pause:function(e){this.paused||(e?this._pausedOnHide=!0:this.paused=!0,game.scene&&game.scene._pause&&game.scene._pause())},resume:function(e){e&&this.paused||(e||this.paused)&&(e?this._pausedOnHide=!1:this.paused=!1,game.Timer.last=Date.now(),game.scene&&game.scene._resume&&game.scene._resume())},setScene:function(e){var t=game[e];t&&(this.sceneName=e,this._running&&!this.paused?this._newSceneClass=t:this._setSceneNow(t))},_scale:function(e,t){game.System.scale&&(e/this.originalWidth<t/this.originalHeight?(this.canvasWidth=e,this.canvasHeight=~~(e*(this.originalHeight/this.originalWidth))):(this.canvasWidth=~~(t*(this.originalWidth/this.originalHeight)),this.canvasHeight=t))},_resize:function(e,t){if(game.System.resize){if(!game.System.scale)return this.resize(e,t),this.canvasWidth=e,void(this.canvasHeight=t);var i=e-this.canvasWidth,s=t-this.canvasHeight;if(i>0){var n=i/this.canvasWidth,a=~~(this.originalWidth*game.scale+this.originalWidth*n*game.scale);this.resize(a,this.originalHeight*game.scale),this.canvasWidth+=i}else if(s>0){var n=s/this.canvasHeight,r=~~(this.originalHeight*game.scale+this.originalHeight*n*game.scale);this.resize(this.originalWidth*game.scale,r),this.canvasHeight+=s}}},_toggleRotateScreen:function(){return game.device.mobile&&game.System.rotateScreen?this.originalWidth>this.originalHeight&&window.innerWidth<window.innerHeight||this.originalHeight>this.originalWidth&&window.innerHeight<window.innerWidth?(this._showRotateScreen(),!0):(this._hideRotateScreen(),!1):!1
},_showRotateScreen:function(){this._rotateScreenVisible||(this._rotateScreenVisible=!0,game.renderer._hide(),document.body.className=game.System.rotateScreenClass)},_hideRotateScreen:function(){this._rotateScreenVisible&&(this._rotateScreenVisible=!1,game.renderer._show(),document.body.className="")},_onWindowResize:function(){if(!this._toggleRotateScreen()){var e=window.innerWidth,t=window.innerHeight;this.retina&&(this.canvasWidth/=2,this.canvasHeight/=2),this._scale(e,t),this._resize(e,t),game.System.center&&game.renderer._position((e-this.canvasWidth)/2,(t-this.canvasHeight)/2),(game.System.scale||game.System.resize||this.retina)&&game.renderer._size(this.canvasWidth,this.canvasHeight),game._loader&&!game._loader.started&&game._loader.start()}},_setSceneNow:function(e){this.paused&&(this.paused=!1),game.scene&&game.scene.exit&&game.scene.exit(),game.tween&&game.tween.removeAll(),game.scene=new e,this._newSceneClass=null,this._startRunLoop()},_startRunLoop:function(){this._runLoopId&&this._stopRunLoop(),this._runLoopId=game._setGameLoop(this._run.bind(this)),this._running=!0},_stopRunLoop:function(){game._clearGameLoop(this._runLoopId),this._running=!1},_run:function(){this.paused||this._pausedOnHide||(game.Timer.update(),game.delta=this.delta=game.Timer.delta/1e3,game.input._update(),game.scene._update(),this._newSceneClass&&this._setSceneNow(this._newSceneClass,this._removeAssets))}}),game.addAttributes("System",{canvasId:"canvas",center:!1,height:600,hires:0,hiresRatio:2,pauseOnHide:!0,resize:!1,retina:!1,rotateScreen:!0,rotateScreenClass:"rotate",scale:!1,startScene:"Main",width:800})}),game.module("engine.timer").body(function(){game.createClass("Timer",{target:0,base:0,_last:0,_pauseTime:0,init:function(e){this._last=game.Timer.time,this.set(e)},set:function(e){"number"!=typeof e&&(e=0),this.target=e,this.reset()},reset:function(){this.base=game.Timer.time,this._pauseTime=0},delta:function(){var e=game.Timer.time-this._last;return this._last=game.Timer.time,this._pauseTime?0:e},time:function(){var e=(this._pauseTime||game.Timer.time)-this.base-this.target;return e},pause:function(){this._pauseTime||(this._pauseTime=game.Timer.time)},resume:function(){this._pauseTime&&(this.base+=game.Timer.time-this._pauseTime,this._pauseTime=0)}}),game.addAttributes("Timer",{time:0,speed:1,minFPS:20,delta:0,_last:0,_realDelta:0,update:function(){var e=Date.now();this._last||(this._last=e),this._realDelta=e-this._last,this.delta=Math.min(this._realDelta,1e3/this.minFPS)*this.speed,this.time+=this.delta,this._last=e}})}),game.module("engine.tween").body(function(){game.createClass("TweenEngine",{tweens:[],removeAll:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e]._shouldRemove=!0},stopTweensForObject:function(e){for(var t=this.tweens.length-1;t>=0;t--)this.tweens[t].object===e&&this.tweens[t].stop()},getTweenForObject:function(e){for(var t=this.tweens.length-1;t>=0;t--)if(this.tweens[t].object===e)return this.tweens[t];return!1},_add:function(e){this.tweens.push(e)},_remove:function(e){var t=this.tweens.indexOf(e);-1!==t&&(this.tweens[t]._shouldRemove=!0)},_update:function(){if(0===this.tweens.length)return!1;for(var e=this.tweens.length-1;e>=0;e--)this.tweens[e]._update()||this.tweens.splice(e,1);return!0}}),game.createClass("Tween",{playing:!1,paused:!1,object:null,duration:1e3,repeatCount:0,yoyoEnabled:!1,reversed:!1,delayTime:0,delayRepeat:!1,easingFunction:null,interpolationFunction:null,chainedTweens:[],onStartCallback:null,onUpdateCallback:null,onCompleteCallback:null,onRepeatCallback:null,currentTime:0,_shouldRemove:!1,_onStartCallbackFired:!1,_valuesStart:{},_valuesEnd:null,_valuesStartRepeat:{},_repeats:0,_startTime:null,_originalStartTime:null,init:function(e){if("object"!=typeof e)throw"Tween parameter must be object";this.object=e,this.easingFunction=game.Tween.Easing.Linear.None,this.interpolationFunction=game.Tween.Interpolation.Linear;for(var t in e)this._valuesStart[t]=parseFloat(e[t],10)},to:function(e,t){return this.duration=t||this.duration,this._valuesEnd=e,this},start:function(){game.tween._add(this),this.currentTime=0,this.playing=!0,this._onStartCallbackFired=!1,this._startTime=this.delayTime,this._originalStartTime=this._startTime;for(var e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this.object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this.object[e],this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this},stop:function(){return this.playing?(game.tween._remove(this),this.playing=!1,this._stopChainedTweens(),this):this},pause:function(){this.paused=!0},resume:function(){this.paused=!1},delay:function(e,t){return this.delayTime=e,this.delayRepeat=!!t,this},repeat:function(e){return"undefined"==typeof e&&(e=1/0),this.repeatCount=e,this},yoyo:function(e){return"undefined"==typeof e&&(e=!0),this.yoyoEnabled=e,this},easing:function(e){return"string"==typeof e?(e=e.split("."),this.easingFunction=game.Tween.Easing[e[0]][e[1]]):this.easingFunction=e,this},interpolation:function(e){return this.interpolationFunction=e,this},chain:function(){return this.chainedTweens=arguments,this},onStart:function(e){return this.onStartCallback=e,this},onUpdate:function(e){return this.onUpdateCallback=e,this},onComplete:function(e){return this.onCompleteCallback=e,this},onRepeat:function(e){return this.onRepeatCallback=e,this},_stopChainedTweens:function(){for(var e=0,t=this.chainedTweens.length;t>e;e++)this.chainedTweens[e].stop()},_update:function(){if(this._shouldRemove)return!1;if(this.paused)return!0;if(this.currentTime+=1e3*game.system.delta,this.currentTime<this._startTime)return!0;this._onStartCallbackFired===!1&&(null!==this.onStartCallback&&this.onStartCallback.call(this.object),this._onStartCallbackFired=!0);var e=(this.currentTime-this._startTime)/this.duration;e=e>1?1:e;var t,i=this.easingFunction(e);for(t in this._valuesEnd){var s=this._valuesStart[t]||0,n=this._valuesEnd[t];n instanceof Array?this.object[t]=this.interpolationFunction(n,i):("string"==typeof n&&(n=s+parseFloat(n,10)),"number"==typeof n&&(this.object[t]=s+(n-s)*i))}if(null!==this.onUpdateCallback&&this.onUpdateCallback.call(this.object,i),1===e){if(this.repeatCount>0){isFinite(this.repeatCount)&&this.repeatCount--,this._repeats+=1;for(t in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10)),this.yoyoEnabled){var a=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=a,this.reversed=!this.reversed}this._valuesStart[t]=this._valuesStartRepeat[t]}return this.delayRepeat||(this.delayTime=0),this._startTime=this._originalStartTime+this._repeats*(this.duration+this.delayTime),null!==this.onRepeatCallback&&this.onRepeatCallback.call(this.object),!0}this.playing=!1,null!==this.onCompleteCallback&&this.onCompleteCallback.call(this.object);for(var r=0,o=this.chainedTweens.length;o>r;r++)this.chainedTweens[r].start();return!1}return!0}}),game.Tween.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s)))},Out:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/s)+1)},InOut:function(e){var t,i=.1,s=.4;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=s/4):t=s*Math.asin(1/i)/(2*Math.PI),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s):i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/s)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-game.Tween.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*game.Tween.Easing.Bounce.In(2*e):.5*game.Tween.Easing.Bounce.Out(2*e-1)+.5}}},game.Tween.Interpolation={Linear:function(e,t){var i=e.length-1,s=i*t,n=Math.floor(s),a=game.Tween.Interpolation.Utils.Linear;return 0>t?a(e[0],e[1],s):t>1?a(e[i],e[i-1],i-s):a(e[n],e[n+1>i?i:n+1],s-n)},Bezier:function(e,t){var i,s=0,n=e.length-1,a=Math.pow,r=game.Tween.Interpolation.Utils.Bernstein;for(i=0;n>=i;i++)s+=a(1-t,n-i)*a(t,i)*e[i]*r(n,i);return s},CatmullRom:function(e,t){var i=e.length-1,s=i*t,n=Math.floor(s),a=game.Tween.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(n=Math.floor(s=i*(1+t))),a(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],s-n)):0>t?e[0]-(a(e[0],e[0],e[1],e[1],-s)-e[0]):t>1?e[i]-(a(e[i],e[i],e[i-1],e[i-1],s-i)-e[i]):a(e[n?n-1:0],e[n],e[n+1>i?i:n+1],e[n+2>i?i:n+2],s-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=game.Tween.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,s=1;if(e[t])return e[t];for(i=t;i>1;i--)s*=i;return e[t]=s}}(),CatmullRom:function(e,t,i,s,n){var a=.5*(i-e),r=.5*(s-t),o=n*n,h=n*o;return(2*t-2*i+a+r)*h+(-3*t+3*i-2*a-r)*o+a*n+t}}},game.createClass("TweenGroup",{tweens:[],onComplete:null,_complete:!1,init:function(e){this.onComplete=e},add:function(e){return e.onComplete(this._tweenComplete.bind(this)),this.tweens.push(e),e},remove:function(e){this.tweens.erase(e)},start:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].start()},pause:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].pause()},resume:function(){for(var e=0;e<this.tweens.length;e++)this.tweens[e].resume()},stop:function(e,t){if(!this._complete){for(var i=0;i<this.tweens.length;i++)this.tweens[i].stop(t);!this._complete&&e&&this._tweenComplete(),this._complete=!0}},_tweenComplete:function(){if(!this._complete){for(var e=0;e<this.tweens.length;e++)if(this.tweens[e].playing)return;this._complete=!0,"function"==typeof this.onComplete&&this.onComplete()}}})});game.build=1433748330191;